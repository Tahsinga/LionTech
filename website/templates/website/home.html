{% load static %}
{% load product_extras %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>LionTech Zimbabwe - Future of Technology</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Discover the latest tech products at LionTech Zimbabwe. Shop mobiles, TVs, laptops, accessories and more.">

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <!-- Leaflet Control Geocoder CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
  <!-- Leaflet Control Geocoder JS -->
  <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>

  <!-- Bootstrap & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'website/css/style.css' %}">
  <link rel="stylesheet" href="{% static 'website/css/cart_style.css' %}">
  <link rel="stylesheet" href="{% static 'website/css/products_addto_cart.css' %}">
  <link rel="stylesheet" href="{% static 'website/css/product_list.css' %}">
  <link rel="stylesheet" href="{% static 'website/css/hotDeals.css' %}">
  <link rel="stylesheet" href="{% static 'website/css/newArrival.css' %}">
  <link rel="stylesheet" href="{% static 'website/css/accounts.css' %}">
  <link rel="stylesheet" href="{% static 'website/css/testimonial.css' %}">
  <link rel="stylesheet" href="{% static 'website/css/product_detail.css' %}">
</head>

    <!-- Mobile improvements -->
    <style>
      /* Base adjustments for small devices */
      @media (max-width: 768px) {
        body { font-size: 15px; line-height: 1.4; }
        .header-wrapper .navbar-brand img { height: 48px; width: 48px; }
        .header-wrapper .navbar-brand span { font-size: 20px; }

        /* Increase tappable areas */
        .nav-icons a, .nav-icons button { padding: 10px; }

        /* Stack header elements */
        .navbar .container { display: flex; flex-wrap: wrap; gap: 8px; align-items: center; }

        /* Product card adjustments */
        .product-item { padding: 6px; }
        .product-card { border-radius: 12px; padding: 12px; box-shadow: 0 6px 18px rgba(10,10,10,0.06); }
        .product-image-wrapper img { max-height: 160px; }
        .product-name { font-size: 16px; font-weight: 600; }
        .product-price { font-size: 15px; color: #1e3a8a; }

        /* Cart layout becomes vertical */
        .cart-content-grid { display: block; padding: 12px; }
        .cart-items-section, .cart-summary-section { width: 100%; }
        .cart-items-section { margin-bottom: 16px; }
        .cart-item-card { display:flex; gap:10px; align-items:center; padding:10px; border-radius:8px; }
        .cart-item-card .product-image-container img { width: 72px; height:72px; object-fit:cover; border-radius:8px; }
        .cart-summary-section .summary-card { padding:12px; border-radius:10px; box-shadow: 0 6px 18px rgba(0,0,0,0.06); }
        .summary-card h3 { font-size: 18px; }

        /* Buttons full-width and larger touch targets */
        .checkout-btn, .btn { width: 100% !important; padding: 12px 14px; font-size: 16px; }

        /* Modal/cart body scroll improvements */
        #cartModal .modal-body { max-height: 60vh; overflow-y: auto; }

        /* Make select elements easier to tap */
        .modern-select { font-size: 16px; padding: 12px; }

        /* Reduce the header clutter on mobile */
        .toggle-text.d-lg-inline { display: none !important; }

        /* Orders / history readability */
        .order-history-container { padding: 12px; }
        .order-item { gap: 8px; }

        /* Ensure cart totals are clear */
        .summary-row span { display: inline-block; width: 60%; }
        .summary-row .total-price { text-align: right; width: 40%; }
      }

      /* Very small screens fine-tuning */
      @media (max-width: 420px) {
        .product-image-wrapper img { max-height: 140px; }
        .product-name { font-size: 14px; }
        .product-price { font-size: 14px; }
        .cart-item-card { padding: 8px; }
      }
    </style>
<body>
  <!-- Header -->
  <div class="header-wrapper">
    <nav class="navbar navbar-expand-lg py-0">
      <div class="container">
        <!-- Logo and Brand Name -->
        <a class="navbar-brand d-flex align-items-center gap-2" href="#" style="text-decoration: none;">
          <img src="{% static 'website/images/lionetech_logo.png' %}" 
              alt="LionTech Logo"
              style="height: 65px; width: 65px; border-radius: 50%; object-fit: cover; background-color: white;">
          <span style="
            font-size: 34px; 
            font-weight: 700; 
            letter-spacing: 1px;
            background: linear-gradient(90deg, #01f0fa, #1e129e);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            display: inline-block;
          ">
            LIONTECH
          </span>
        </a>

        <!-- Search Bar -->
        <form class="d-flex flex-grow-1 mx-3" method="get" action=".">
          <input class="form-control" id="liveSearchInput" name="search" type="search" value="{{ current_search }}" placeholder="Search Liontech.co.zw" autocomplete="off" />
          <input type="hidden" name="filter" value="{{ current_filter }}">
        </form>

        <!-- Right Side Icons -->
        <div class="d-flex align-items-center nav-icons">
          <a href="{% url 'account_login' %}" class="me-3 text-decoration-none">
            <button type="button" class="btn btn-outline-primary btn-sm rounded-pill d-flex align-items-center gap-2" aria-label="Log in">
              <i class="bi bi-box-arrow-in-right fs-5" aria-hidden="true"></i>
              <span class="d-none d-lg-inline">Log In</span>
            </button>
          </a>

          <!-- Cart Icon with Count and Modal Trigger -->
          <a href="#" id="cartIcon" class="me-3 text-dark text-decoration-none position-relative">
              <i class="bi bi-bag fs-5"></i>
              <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" id="cart-count">0</span>
          </a>

          <div id="toggleViewBtn" style="display: inline-block; cursor: pointer;">
            <button class="btn btn-success" type="button" style="background: #9150ec;">
              <i class="bi bi-cart-plus me-1"></i> 
              <span class="toggle-text d-none d-lg-inline">Your Orders</span>
            </button>
          </div>
        </div>

          <script>
            // Expose server-rendered search/filter info to client code.
            // The section controller (defined later) will consume this and open the
            // products section if needed. We avoid calling showSection directly here
            // so the controller can decide whether to reset filters or not.
            document.addEventListener('DOMContentLoaded', function() {
              try {
                window.serverFilterInit = {
                  currentSearch: '{{ current_search|default:"" }}'.trim(),
                  currentFilter: '{{ current_filter|default:"" }}'.trim()
                };
              } catch (e) { /* ignore in templates if missing */ }
            });
          </script>
      </div>
    </nav>

    <!-- Category Menu -->
    <div id="categoryMenu" class="bg-light py-2 border-top">
      <div id="cartSection" class="container mt-4 d-none">
        <!-- Cart content will load here -->
      </div>

      <div class="container">
        <div class="d-flex justify-content-center flex-wrap gap-1">
          <button id="load_home_contents" class="nav-link px-2" style="background: none; border: none; color: inherit;">
            Home
          </button>
          <button id="load_product_list" class="nav-link px-2" style="background: none; border: none; color: inherit;">
            Products
          </button>          
          <button id="load_my_cart" class="nav-link px-2" style="background: none; border: none; color: inherit; display: none;">
            Cart
          </button> 
          <button id="load_accounts" class="nav-link px-2" style="background: none; border: none; color: inherit;">
            Accounts
          </button> 
          <button id="load_testimony" class="nav-link px-2" style="background: none; border: none; color: inherit;">
            Customer Reviews
          </button> 
          <button id="load_history" class="nav-link px-2" style="background: none; border: none; color: inherit; display: none;">
            Orders
          </button> 
          <button id="load_about_us" class="nav-link px-2" style="background: none; border: none; color: inherit;">
            About us
          </button> 
        </div>
      </div>
    </div>
  </div>

  <!-- Inline product viewer container (kept hidden until a product is clicked) -->
  <div id="productContainer" class="product-container" style="display: none;"></div>

  <!-- Product list page now-->
  <div id="promotion_page" style="display: none;"class="mt-3"> 
    <!-- Content Section -->
    <section class="py-3">
      <div class="container">
        <div class="row">
          <!-- Sidebar -->
          <div class="col-lg-3">
            <div class="sidebar mb-4">
              <ul>
                <li><a href="?page=1&filter=all{% if current_search %}&search={{ current_search }}{% endif %}" data-filter="all" class="category-link ajax-category">All items</a></li>
                <li><a href="?page=1&filter=Tempered Glass{% if current_search %}&search={{ current_search }}{% endif %}" data-filter="Tempered Glass" class="category-link ajax-category">Tempered Glass</a></li>
                <li><a href="?page=1&filter=Network Devices{% if current_search %}&search={{ current_search }}{% endif %}" data-filter="Network Devices" class="category-link ajax-category">Network Devices</a></li>
                <li><a href="?page=1&filter=Videos Games{% if current_search %}&search={{ current_search }}{% endif %}" data-filter="Videos Games" class="category-link ajax-category">Videos Games</a></li>
                <li><a href="?page=1&filter=Mouse{% if current_search %}&search={{ current_search }}{% endif %}" data-filter="Mouse" class="category-link ajax-category">Mouse</a></li>
                <li><a href="?page=1&filter={{ 'TV & Projectors'|urlencode }}{% if current_search %}&search={{ current_search }}{% endif %}" data-filter="TV & Projectors" class="category-link ajax-category">TV & Projectors</a></li>
                <li><a href="?page=1&filter=Accessories{% if current_search %}&search={{ current_search }}{% endif %}" data-filter="Accessories" class="category-link ajax-category">Accessories</a></li>
                <li><a href="?page=1&filter={{ 'Mobiles & Accessories'|urlencode }}{% if current_search %}&search={{ current_search }}{% endif %}" data-filter="Mobiles & Accessories" class="category-link ajax-category">Mobiles & Accessories</a></li>
                <li><a href="?page=1&filter=Headphones{% if current_search %}&search={{ current_search }}{% endif %}" data-filter="Headphones" class="category-link ajax-category">Headphones</a></li>
                <li><a href="?page=1&filter=Gaming Laptops{% if current_search %}&search={{ current_search }}{% endif %}" data-filter="Gaming Laptops" class="category-link ajax-category">Gaming Laptops</a></li>
                <li><a href="?page=1&filter=Smart Watches{% if current_search %}&search={{ current_search }}{% endif %}" data-filter="Smart Watches" class="category-link ajax-category">Smart Watches</a></li>
                <li><a href="?page=1&filter=Laptops{% if current_search %}&search={{ current_search }}{% endif %}" data-filter="Laptops" class="category-link ajax-category">Laptops</a></li>
                <li><a href="?page=1&filter=Sound Bars{% if current_search %}&search={{ current_search }}{% endif %}" data-filter="Sound Bars" class="category-link ajax-category">Sound Bars</a></li>
                <li><a href="?page=1&filter=Monitors{% if current_search %}&search={{ current_search }}{% endif %}" data-filter="Monitors" class="category-link ajax-category">Monitors</a></li>
                <li><a href="?page=1&filter=Speakers{% if current_search %}&search={{ current_search }}{% endif %}" data-filter="Speakers" class="category-link ajax-category">Speakers</a></li>

                <!-- <div class="sidebar-header mt-4">Special Categories</div>
                <hr style="border: 2px solid #000000;" />

                <li><a href="?page=1&filter=Choose Color{% if current_search %}&search={{ current_search }}{% endif %}" class="category-link">Choose Color</a></li>
                <li><a href="?page=1&filter=Select Price{% if current_search %}&search={{ current_search }}{% endif %}" class="category-link">Select Price</a></li>
                <li><a href="?page=1&filter=Connection Type{% if current_search %}&search={{ current_search }}{% endif %}" class="category-link">Connection Type</a></li>
                <li><a href="?page=1&filter=CPU Size{% if current_search %}&search={{ current_search }}{% endif %}" class="category-link">CPU Size</a></li>
                <li><a href="?page=1&filter=Storage Size{% if current_search %}&search={{ current_search }}{% endif %}" class="category-link">Storage Size</a></li> -->
              </ul>
            </div>
            
            <div class="deal-of-the-day modern-tech-deal" id="deal-of-the-day">
                <div class="deal-header">
                    <h6 class="deal-title"><i class="bi bi-lightning-charge-fill"></i> FLASH TECH DEAL</h6>
                    <div class="countdown-badge">
                        <span id="deal-countdown">23:59:59</span>
                    </div>
                </div>

                <!-- Modern Carousel -->
                <div id="techDealCarousel" class="carousel slide" data-bs-ride="carousel">
                    <div class="carousel-indicators">
                        <button type="button" data-bs-target="#techDealCarousel" data-bs-slide-to="0" class="active"></button>
                        <button type="button" data-bs-target="#techDealCarousel" data-bs-slide-to="1"></button>
                        <button type="button" data-bs-target="#techDealCarousel" data-bs-slide-to="2"></button>
                    </div>
                    <div class="carousel-inner rounded-4">
                        <div class="carousel-item active">
                            <img src="https://placehold.co/600x400/3b82f6/white?text=Flagship+Phone" class="d-block w-100" alt="Premium Smartphone">
                            <div class="deal-badge">30% OFF</div>
                        </div>
                        <div class="carousel-item">
                            <img src="https://placehold.co/600x400/10b981/white?text=Ultra+Thin+Laptop" class="d-block w-100" alt="Ultra Thin Laptop">
                            <div class="deal-badge">FREE ACCESSORIES</div>
                        </div>
                        <div class="carousel-item">
                            <img src="https://placehold.co/600x400/ef4444/white?text=Smart+Gadgets" class="d-block w-100" alt="Smart Gadgets Bundle">
                            <div class="deal-badge">LIMITED STOCK</div>
                        </div>
                    </div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#techDealCarousel" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon"></span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#techDealCarousel" data-bs-slide="next">
                        <span class="carousel-control-next-icon"></span>
                    </button>
                </div>

                <!-- Deal Description -->
                <div class="deal-details mt-3 p-3">
                    <div class="tech-category-badge mb-2">
                        <span class="badge bg-primary">HOT TECH</span>
                        <span class="badge bg-success">FREE SHIPPING</span>
                    </div>
                    <h5 class="product-title mb-1">Premium Tech Bundle</h5>
                    <p class="product-desc mb-2">Smartphone + Laptop + Accessories</p>
                    
                    <div class="price-container mb-2">
                        <span class="current-price">$899.99</span>
                        <span class="original-price">$1,299.99</span>
                        <span class="discount-badge">Save $400</span>
                    </div>
                    
                    <div class="d-flex gap-2">
                        <a href="#" class="btn btn-dark btn-gradient w-75">Shop Now</a>
                        <button class="btn btn-outline-secondary w-25"><i class="bi bi-heart"></i></button>
                    </div>
                    
                    <div class="deal-meta mt-2">
                        <div class="stock-warning">
                            <i class="bi bi-exclamation-triangle-fill"></i> Only 3 left in stock
                        </div>
                    </div>
                </div>
            </div>
          </div>

          <!-- Product Cards -->
          <div class="col-lg-9">
            <!-- Title future of technology -->
            <!-- <div class="container text-center">
              <h1 class="page-title">Future of Technology</h1>
            </div> -->
            <style>
              /* Ensure bundle cards fill available height */
              .bundle-card {
                display: flex;
                flex-direction: column;
                height: 100%;
                background-color: rgb(239, 237, 237);
                border-radius: 1rem;
                position: relative;
              }

              /* Make inner row stretch properly */
              .bundle-card .row {
                flex: 1 1 auto;
              }

              /* Keep images proportional */
              .bundle-card img {
                max-height: 180px;
                object-fit: cover;
                width: 100%;
              }

              @media (min-width: 992px) {
                .bundle-card img {
                  max-height: 200px;
                }
              }
            </style>

            <div class="row" id="productList">
              {% for product in products %}
                <div class="col-md-4 mb-4 product-item" data-category="{{ product.category }}">
                  <form method="POST" action="{% url 'addProduct_to_cart' %}">
                    {% csrf_token %}
                    <div class="product-card">
                      <div class="product-image-wrapper text-center mb-3">
                        <!-- 4-image carousel per product; falls back to default images when missing -->
                        <div id="productCarousel{{ product.id }}" class="carousel slide" data-bs-ride="carousel">
                          <div class="carousel-inner">
                            {% comment %} main image slot {% endcomment %}
                            <div class="carousel-item active">
                              <a href="{% url 'product_detail' product.id %}">
                                {% if product.image %}
                                  <img src="{{ product.image.url }}" class="d-block w-100 img-fluid rounded clickable-image" alt="{{ product.name }}" data-product-id="{{ product.id }}">
                                {% else %}
                                  <img src="{% static 'website/images/default-image.svg' %}" class="d-block w-100 img-fluid rounded clickable-image" alt="{{ product.name }}" data-product-id="{{ product.id }}">
                                {% endif %}
                              </a>
                            </div>

                            {% comment %} image 2 {% endcomment %}
                            <div class="carousel-item">
                              <a href="{% url 'product_detail' product.id %}">
                                {% if product.image_2 %}
                                  <img src="{{ product.image_2.url }}" class="d-block w-100 img-fluid rounded clickable-image" alt="{{ product.name }}" data-product-id="{{ product.id }}">
                                {% else %}
                                  <img src="{% static 'website/images/default-image.svg' %}" class="d-block w-100 img-fluid rounded clickable-image" alt="{{ product.name }}" data-product-id="{{ product.id }}">
                                {% endif %}
                              </a>
                            </div>

                            {% comment %} image 3 {% endcomment %}
                            <div class="carousel-item">
                              <a href="{% url 'product_detail' product.id %}">
                                {% if product.image_3 %}
                                  <img src="{{ product.image_3.url }}" class="d-block w-100 img-fluid rounded clickable-image" alt="{{ product.name }}" data-product-id="{{ product.id }}">
                                {% else %}
                                  <img src="{% static 'website/images/default-image.svg' %}" class="d-block w-100 img-fluid rounded clickable-image" alt="{{ product.name }}" data-product-id="{{ product.id }}">
                                {% endif %}
                              </a>
                            </div>

                            {% comment %} image 4 {% endcomment %}
                            <div class="carousel-item">
                              <a href="{% url 'product_detail' product.id %}">
                                {% if product.image_4 %}
                                  <img src="{{ product.image_4.url }}" class="d-block w-100 img-fluid rounded clickable-image" alt="{{ product.name }}" data-product-id="{{ product.id }}">
                                {% else %}
                                  <img src="{% static 'website/images/default-image.svg' %}" class="d-block w-100 img-fluid rounded clickable-image" alt="{{ product.name }}" data-product-id="{{ product.id }}">
                                {% endif %}
                              </a>
                            </div>
                          </div>
                          <button class="carousel-control-prev" type="button" data-bs-target="#productCarousel{{ product.id }}" data-bs-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Previous</span>
                          </button>
                          <button class="carousel-control-next" type="button" data-bs-target="#productCarousel{{ product.id }}" data-bs-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Next</span>
                          </button>
                        </div>
                      </div>


                      <!-- Main product details -->
                      <div class="product-details text-center mb-2">
                        <h5 class="product-name">{{ product.name }}</h5>
                        
                        <p class="product-price">${{ product.price }}</p>
                        <p class="product-meta"><strong>Condition:</strong> {{ product.condition }}</p>
                      </div>

                      <!-- DELIVERY TAGS -->
                      <div class="text-center mt-auto">

                        <!-- DELIVERY TAGS -->
                        <div class="text-center mt-auto">
                          {% if product.location == "local" %}
                            <p class="product-meta">Delivery: <strong>Tommorrow</strong></p>
                          {% elif product.location == "exotic" %}
                            <p class="product-meta">Delivery: <strong>2 Weeks</strong></p>
                          {% else %}
                            <p class="product-meta">Delivery: <strong>Standard delivery</strong></p>
                          {% endif %}
                        </div>


                        <div class="stars">
                          <input type="radio" name="rating" id="star5-{{ product.id }}" value="5" />
                          <label for="star5-{{ product.id }}">&#9733;</label>
                          <input type="radio" name="rating" id="star4-{{ product.id }}" value="4" />
                          <label for="star4-{{ product.id }}">&#9733;</label>
                          <input type="radio" name="rating" id="star3-{{ product.id }}" value="3" />
                          <label for="star3-{{ product.id }}">&#9733;</label>
                          <input type="radio" name="rating" id="star2-{{ product.id }}" value="2" />
                          <label for="star2-{{ product.id }}">&#9733;</label>
                          <input type="radio" name="rating" id="star1-{{ product.id }}" value="1" />
                          <label for="star1-{{ product.id }}">&#9733;</label>
                        </div>
                      </div>

                      <!-- Hidden extra details -->
                      <div class="more-details text-muted small px-2 pb-2 d-none">
                        {% if product.description and product.description != 'NA' %}
                          <p><strong>Description:</strong> {{ product.description }}</p>
                        {% endif %}
                        {% if product.brand and product.brand != 'NA' %}
                          <p><strong>Brand:</strong> {{ product.brand }}</p>
                        {% endif %}
                        {% if product.stock and product.stock != 'NA' %}
                          <p><strong>Stock:</strong> {{ product.stock }}</p>
                        {% endif %}
                        {% if product.created_at %}
                          <p><strong>Added on:</strong> {{ product.created_at|date:"d M Y" }}</p>
                        {% endif %}
                      </div>

                      <!-- Hidden inputs for form submission -->
                      <input type="hidden" name="product_id" value="{{ product.id }}">
                      <input type="hidden" name="name" value="{{ product.name }}">
                      <input type="hidden" name="price" value="{{ product.price }}">
                      <input type="hidden" name="condition" value="{{ product.condition }}">
                      <input type="hidden" name="category" value="{{ product.category }}">
                      {% if product.image %}
                        {# Use image.name (media-relative path) so server receives 'products/123.jpg' instead of '/media/...' #}
                        <input type="hidden" name="image_url" value="{{ product.image.name }}">
                      {% else %}
                        <input type="hidden" name="image_url" value="{% static 'website/images/default-image.svg' %}">
                      {% endif %}

                      <div class="text-center mt-3">

                        {% if product.available == 1%}
                          <button id="AddToCart" class="btn btn-success w-100 add-to-cart-btn" style="background: #2E6591;" type="submit">
                          <i class="bi bi-cart-plus me-1"></i> Add to Cart  
                        </button>
                        {% endif %}
                        {% if product.available == 0 %}
                          <button class="btn btn-success w-100 add-to-cart-btn" style="background: #9150ec;" type="submit">
                          <i class="bi bi-cart-plus me-1"></i> Out of Stock  >
                        {% endif %}
                      </div>
                    </div>
                  </form>
                </div>
                
                <!-- Offcanvas details (unchanged) -->
                <div class="offcanvas offcanvas-bottom" tabindex="-1" id="detailsOffcanvas{{ product.id }}" aria-labelledby="detailsOffcanvasLabel{{ product.id }}">
                  <div class="offcanvas-header">
                    <h5 class="offcanvas-title" id="detailsOffcanvasLabel{{ product.id }}">{{ product.product_name }} - Details</h5>
                    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                  </div>
                  <div class="offcanvas-body small">
                    {% if product.brand_model and product.brand_model != 'NA' %}
                      <p><strong>Brand:</strong> {{ product.brand_model }}</p>
                    {% endif %}
                    {% if product.color and product.color != 'NA' %}
                      <p><strong>Color:</strong> {{ product.color }}</p>
                    {% endif %}
                    {% if product.storage_ram and product.storage_ram != 'NA' %}
                      <p><strong>Storage/RAM:</strong> {{ product.storage_ram }}</p>
                    {% endif %}
                    {% if product.network and product.network != 'NA' %}
                      <p><strong>Network:</strong> {{ product.network }}</p>
                    {% endif %}
                    {% if product.battery and product.battery != 'NA' %}
                      <p><strong>Battery:</strong> {{ product.battery }}</p>
                    {% endif %}
                    {% if product.camera and product.camera != 'NA' %}
                      <p><strong>Camera:</strong> {{ product.camera }}</p>
                    {% endif %}
                    {% if product.screen and product.screen != 'NA' %}
                      <p><strong>Screen:</strong> {{ product.screen }}</p>
                    {% endif %}
                    {% if product.processor and product.processor != 'NA' %}
                      <p><strong>Processor:</strong> {{ product.processor }}</p>
                    {% endif %}
                    {% if product.os and product.os != 'NA' %}
                      <p><strong>OS:</strong> {{ product.os }}</p>
                    {% endif %}
                    {% if product.accessories and product.accessories != 'NA' %}
                      <p><strong>Accessories:</strong> {{ product.accessories }}</p>
                    {% endif %}
                    {% if product.warranty and product.warranty != 'NA' %}
                      <p><strong>Warranty:</strong> {{ product.warranty }}</p>
                    {% endif %}
                    {% if product.optional_details and product.optional_details != 'NA' %}
                      <p><strong>Optional Details:</strong> {{ product.optional_details }}</p>
                    {% endif %}
                  </div>
                </div>
              {% empty %}
                <div class="col-12 text-center py-5">
                  <i class="bi bi-exclamation-circle fs-1 text-muted"></i>
                  <p class="fs-4 text-muted">No products available.</p>
                </div>
              {% endfor %}
            </div>

            <!-- Pagination Controls -->
            {% if products.paginator.num_pages > 1 %}
              <nav id="productPagination" aria-label="Page navigation">
                <ul class="pagination justify-content-center mt-4">
                  {% if products.has_previous %}
                    <li class="page-item">
                      <a class="page-link" href="?page={{ products.previous_page_number }}{% if current_filter %}&filter={{ current_filter }}{% endif %}{% if current_search %}&search={{ current_search }}{% endif %}">
                        &laquo;
                      </a>
                    </li>
                  {% endif %}

                  {% for num in products.paginator.page_range %}
                    <li class="page-item {% if products.number == num %}active{% endif %}">
                      <a class="page-link" href="?page={{ num }}{% if current_filter %}&filter={{ current_filter }}{% endif %}{% if current_search %}&search={{ current_search }}{% endif %}">
                        {{ num }}
                      </a>
                    </li>
                  {% endfor %}

                  {% if products.has_next %}
                    <li class="page-item">
                      <a class="page-link" href="?page={{ products.next_page_number }}{% if current_filter %}&filter={{ current_filter }}{% endif %}{% if current_search %}&search={{ current_search }}{% endif %}">
                        &raquo;
                      </a>
                    </li>
                  {% endif %}
                </ul>
              </nav>
            {% endif %}
          </div>
        </div>
      </div>
    </section>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
      const sliderTrack = document.querySelector('.slider-track');
      const prevBtn = document.querySelector('.prev-slide');
      const nextBtn = document.querySelector('.next-slide');
      const productCards = document.querySelectorAll('.product-card');
      const cardWidth = productCards[0]?.offsetWidth + 24; // width + gap
      
      let currentPosition = 0;
      const maxPosition = -(productCards.length * cardWidth - sliderTrack.offsetWidth);

      nextBtn.addEventListener('click', function() {
        if (currentPosition > maxPosition) {
          currentPosition -= cardWidth * 3; // slide 3 cards at a time
          if (currentPosition < maxPosition) currentPosition = maxPosition;
          sliderTrack.style.transform = `translateX(${currentPosition}px)`;
        }
      });

      prevBtn.addEventListener('click', function() {
        if (currentPosition < 0) {
          currentPosition += cardWidth * 3; // slide 3 cards at a time
          if (currentPosition > 0) currentPosition = 0;
          sliderTrack.style.transform = `translateX(${currentPosition}px)`;
        }
      });

      // Make slider draggable
      let isDragging = false;
      let startPosition = 0;
      let currentTranslate = 0;
      let prevTranslate = 0;

      sliderTrack.addEventListener('mousedown', dragStart);
      sliderTrack.addEventListener('touchstart', dragStart);
      sliderTrack.addEventListener('mouseup', dragEnd);
      sliderTrack.addEventListener('mouseleave', dragEnd);
      sliderTrack.addEventListener('touchend', dragEnd);
      sliderTrack.addEventListener('mousemove', drag);
      sliderTrack.addEventListener('touchmove', drag);

      function dragStart(e) {
        if (e.type === 'touchstart') {
          startPosition = e.touches[0].clientX;
        } else {
          startPosition = e.clientX;
          e.preventDefault();
        }
        isDragging = true;
        sliderTrack.style.transition = 'none';
      }

      function drag(e) {
        if (isDragging) {
          let currentPosition;
          if (e.type === 'touchmove') {
            currentPosition = e.touches[0].clientX;
          } else {
            currentPosition = e.clientX;
          }
          const diff = currentPosition - startPosition;
          currentTranslate = prevTranslate + diff;
          
          // Prevent dragging beyond boundaries
          if (currentTranslate > 0) {
            currentTranslate = 0;
          } else if (currentTranslate < maxPosition) {
            currentTranslate = maxPosition;
          }
          
          sliderTrack.style.transform = `translateX(${currentTranslate}px)`;
        }
      }

      function dragEnd() {
        isDragging = false;
        prevTranslate = currentTranslate;
        sliderTrack.style.transition = 'transform 0.5s ease';
        
        // Snap to nearest card
        const cardsToShow = Math.floor(sliderTrack.offsetWidth / cardWidth);
        const snapPosition = Math.round(currentTranslate / cardWidth) * cardWidth;
        
        if (snapPosition > 0) {
          currentTranslate = 0;
        } else if (snapPosition < maxPosition) {
          currentTranslate = maxPosition;
        } else {
          currentTranslate = snapPosition;
        }
        
        sliderTrack.style.transform = `translateX(${currentTranslate}px)`;
        currentPosition = currentTranslate;
        prevTranslate = currentTranslate;
      }
    });
    </script>
  </div>

  <!-- Cart Modal -->
  <div class="modal fade" id="cartModal" tabindex="-1" aria-labelledby="cartModalLabel" aria-hidden="true" >
    <div class="modal-dialog modal-dialog-centered modal-md">
      <div class="modal-content shadow-sm border-0">
        
        <!-- Header -->
        <div class="modal-header">
          <h5 class="modal-title" id="cartModalLabel">🛒 Cart</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <!-- Body -->
        <div class="modal-body" id="cartModalBody" style="max-height: 320px; overflow-y: auto;">
          <!-- Example Cart Item -->
          <ul class="list-group list-group-flush">
            <!-- Dynamic items will be appended here -->
            <li class="list-group-item d-flex justify-content-between align-items-center py-2 px-2 border-0 border-bottom">
              <div class="d-flex align-items-center gap-2">
                <span class="badge bg-dark-subtle text-dark fw-semibold rounded-pill" style="min-width: 30px;">2×</span>
                <span class="fw-semibold">Wireless Mouse</span>
              </div>
              <span class="text-muted small">$15.00</span>
            </li>

            <!-- Empty Cart Fallback -->
            <!-- <p class="text-muted text-center">Your cart is empty.</p> -->
          </ul>
        </div>


        <!-- Footer -->
        <div class="modal-footer flex-column align-items-stretch gap-2">
          <form id="customerForm" class="row g-2 w-100 px-2">
            <div class="col-6">
              <input type="text" class="form-control form-control-sm" id="firstName" placeholder="First Name" required>
            </div>
            <div class="col-6">
              <input type="text" class="form-control form-control-sm" id="lastName" placeholder="Last Name" required>
            </div>
            <div class="col-6">
              <input type="tel" class="form-control form-control-sm" id="phoneNumber" placeholder="Phone Number" required>
            </div>

            <div class="container my-4">
              <div class="row">
                <div class="col-md-4">
                  <select id="citySelect" class="form-select">
                    <option value="">Select City</option>
                    <option value="Harare">Harare</option>
                    <option value="Bulawayo">Bulawayo</option>
                    <option value="Mutare">Mutare</option>
                  </select>
                </div>
                <div class="col-md-4">
                  <input id="placeInput" class="form-control" placeholder="Enter place in city..." />
                </div>
                <div class="col-md-4">
                  <button class="btn btn-primary w-100" onclick="searchPlace()">Search</button>
                </div>
              </div>
            </div>

            <div id="map" style="height: 250px; width: 100%; margin-top: 10px; border-radius: 8px;"></div>
            <input type="hidden" id="lat" name="lat">
            <input type="hidden" id="lng" name="lng">

            <div class="col-6">
              <input type="text" class="form-control form-control-sm" id="location" placeholder="Location" required>
            </div>
          </form>

          <div class="d-flex justify-content-between w-100 mt-2 px-2">
            <button type="button" class="btn btn-outline-secondary btn-sm" data-bs-dismiss="modal">Continue</button>
            <button type="button" class="btn btn-success btn-sm" id="checkoutBtn">Checkout</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="products_addto_cart" style="display: none;"> 
    <!-- New Add to Cart page -->
      <div id="products_addto_cart_Mobile" class="products_addto_cart_Mobile">
        <!-- New Add to Cart page -->
        <div id="products_addto_cart_mobile_inner">
          <div class="cart-container mobile-cart">
          <main class="cart-main-content">
            <div class="cart-header">
              <div class="cart-title">
                <i class="fas fa-shopping-cart" style="color: #cc4f1e;"></i>
                <h1>Your Shopping Cart</h1>
              </div>
            </div>

            <!-- Stack layout (TOP → BOTTOM) -->
            <div class="cart-vertical-layout">

              <!-- CUSTOMER INFO AT TOP -->
              <div class="customer-info-card">
                <h3>Customer Information</h3>
                <form method="POST" action="{% url 'checkout' %}">
                  {% csrf_token %}

                  <div class="form-group">
                    <label for="fullname">Full Name</label><br>
                    <input style="width: 100%;" type="text" name="fullname" id="fullname" placeholder="John Doe" class="modern-select" required>
                  </div>

                  <div class="form-group">
                    <label for="phone">Phone Number</label><br>
                    <input style="width: 100%;" type="tel" name="phone" id="phone" placeholder="+263 771 234 567" class="modern-select" required>
                  </div>

                  <div class="form-group">
                    <label for="email">Email</label><br>
                    <input style="width: 100%;" type="email" name="email" id="email" placeholder="john@gmail.com" class="modern-select" required>
                  </div>

                  <div class="form-group">
                    <label for="delivery-location" class="dropdown-label">Select City</label><br>
                    <select style="width: 100%;" id="delivery-location" name="delivery_location" class="modern-select" required>
                      <option value="">Select your location</option>
                      <option value="harare">Harare</option>
                      <option value="bulawayo">Bulawayo</option>
                      <option value="mutare">Mutare</option>
                      <option value="gweru">Gweru</option>
                      <option value="masvingo">Masvingo</option>
                      <option value="kadoma">Kadoma</option>
                      <option value="kwekwe">Kwekwe</option>
                      <option value="marondera">Marondera</option>
                      <option value="chegutu">Chegutu</option>
                      <option value="bindura">Bindura</option>
                      <option value="chipinge">Chipinge</option>
                      <option value="chinhoyi">Chinhoyi</option>
                      <option value="mutoko">Mutoko</option>
                      <option value="ruwa">Ruwa</option>
                      <option value="checheche">Checheche</option>
                      <option value="masvingo town">Masvingo Town</option>
                      <option value="shurugwi">Shurugwi</option>
                      <option value="redcliff">Redcliff</option>
                      <option value="gokwe">Gokwe</option>
                      <option value="beitbridge">Beitbridge</option>
                      <option value="chisumbanje">Chisumbanje</option>
                      <option value="murewa">Murewa</option>
                      <option value="maramba">Maramba</option>
                      <option value="esigodini">Esigodini</option>
                      <option value="zvishavane">Zvishavane</option>
                      <option value="mutare suburbs">Mutare Suburbs</option>
                      <option value="harare suburbs">Harare Suburbs</option>
                      <option value="bulawayo suburbs">Bulawayo Suburbs</option>
                    </select>
                  </div>

                  <div class="form-group">
                    <label for="address">Shipping Address</label><br>
                    <textarea style="width: 100%;" name="address" id="address" rows="3"
                      placeholder="123 Main St, Apt 4B&#10;New York, NY 10001" class="modern-select" required></textarea>
                  </div>

                  <div class="form-group">
                    <label for="notes">Delivery Notes (Optional)</label><br>
                    <textarea style="width: 100%;" name="notes" id="notes" rows="2"
                      placeholder="Leave at front door if I'm not home" class="modern-select"></textarea>
                  </div>

                  <div class="line"></div>
              </div>

              <!-- PRODUCTS IN THE MIDDLE -->
              <div class="cart-items-section">
                <h2>Products</h2>
                <div class="cart-items-header">
                  <span>Item</span>
                  <span>Price</span>
                </div>

                {% if cartProducts %}
                {% for item in cartProducts %}
                <div class="cart-item-card" data-product-id="{{ item.product_id }}">
                  <div class="product-image-container">
                    {% if item.image %}
                    <img src="{{ item.image }}" alt="{{ item.name }}" class="clickable-image" data-product-id="{{ item.product_id }}" title="View product details">
                    {% else %}
                    <img src="https://via.placeholder.com/120x120?text=No+Image" alt="No Image Available" class="clickable-image" data-product-id="{{ item.product_id }}" title="View product details">
                    {% endif %}
                  </div>
                  <div class="product-details">
                    <h3 class="product-title">{{ item.name }}</h3>
                    <div class="product-specs">
                      Condition: {{ item.condition|default:"N/A" }}<br>
                      Category: {{ item.category|default:"Uncategorized" }}
                    </div>
                    <div class="quantity-control">
                      <button class="quantity-btn" data-action="decrease" data-product-id="{{ item.product_id }}">-</button>
                      <span class="quantity-value">{{ item.quantity }}</span>
                      <button class="quantity-btn" data-action="increase" data-product-id="{{ item.product_id }}">+</button>
                    </div>
                    <div class="product-price">
                      $<strong><span class="item-total">{{ item.total_price|floatformat:2 }}</span></strong>
                    </div>
                    <div class="product-actions">
                      <button class="remove-btn" data-product-id="{{ item.product_id }}">
                        <i class="far fa-trash-alt"></i> Remove
                      </button>
                      <button class="save-btn clickable-image" data-product-id="{{ item.product_id }}" title="View product details">
                        <i class="far fa-heart"></i> Product Detail
                      </button>
                    </div>
                  </div>
                  
                </div>
                {% endfor %}
                {% else %}
                <p>Your cart is empty.</p>
                {% endif %}
              </div>

              <!-- SUMMARY AT BOTTOM -->
              <div class="summary-card">
                <h3>Order Summary</h3>
                <div class="summary-row">
                  <span>Subtotal (<span class="total-items">{{ cart_items|length }}</span> items)</span>
                  <span>$<span class="subtotal-amount">{{ subtotal }}</span></span>
                </div>

                <div class="summary-row">
                  <span>Tax (15%)</span>
                  <span>$<span class="tax-amount">{{ taxes }}</span></span>
                </div>

                <div class="summary-row">
                  <span>Delivery Cost</span>
                  <span>$<span id="delivery-cost-amount">{{ delivery_cost|default:"0.00" }}</span></span>
                </div>

                <div class="line"></div>

                <div class="summary-row total">
                  <span>Total</span>
                  <span>$<span id="grand-total-amount">{{ total|default:"0.00" }}</span></span>
                </div>

                <input type="hidden" name="delivery_cost" id="delivery_cost_input" value="{{ delivery_cost|default:'0.00' }}">

                <button type="submit" class="checkout-btn">Proceed to Checkout</button>

                <div class="payment-methods">
                  <i class="fab fa-cc-visa"></i>
                  <i class="fab fa-cc-mastercard"></i>
                  <i class="fab fa-cc-amex"></i>
                  <i class="fab fa-cc-paypal"></i>
                </div>

                <button type="reset" class="reset-btn">
                  <i class="fas fa-redo-alt"></i> Reset Form
                </button>
              </div>

              </form>
            </div>
          </main>
        </div>
      </div>

      <style>
        .cart-vertical-layout {
          display: flex;
          flex-direction: column;
          gap: 25px;
        }

        .customer-info-card,
        .cart-items-section,
        .summary-card {
          background: #fff;
          border-radius: 12px;
          padding: 20px;
          box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
        }

        .checkout-btn {
          width: 100%;
          padding: 12px;
          background: #cc4f1e;
          color: white;
          border: none;
          border-radius: 8px;
          font-weight: 600;
          margin-top: 10px;
          cursor: pointer;
        }

        .checkout-btn:hover {
          background: #b03d13;
        }

        .reset-btn {
          margin-top: 10px;
          width: 100%;
          padding: 10px;
          background: #f1f1f1;
          border: none;
          border-radius: 8px;
          font-weight: 500;
          cursor: pointer;
        }

        .reset-btn:hover {
          background: #e3e3e3;
        }

        .line {
          width: 100%;
          height: 2px;
          background-color: #ddd;
          margin: 15px 0;
        }
      </style>

  </div> 
    
  <div class="cart-container desktop-cart">
      <main class="cart-main-content">
        <div class="cart-header">
          <div class="cart-title">
            <i class="fas fa-shopping-cart" style="color: #cc4f1e;"></i>
            <h1>Your Shopping Cart</h1>
          </div>
        </div>

        <div class="cart-content-grid">
          <div class="cart-items-section">
            <div class="cart-items-header">
              <h2>Products</h2>
              <span>Price</span>
            </div>

            {% if cartProducts %}
              {% for item in cartProducts %}
                <div class="cart-item-card" data-product-id="{{ item.product_id }}">
                  <div class="product-image-container">
                    {% if item.image %}
                      <img src="{{ item.image }}" alt="{{ item.name }}" class="clickable-image" data-product-id="{{ item.product_id }}" title="View product details">
                    {% else %}
                      <img src="https://via.placeholder.com/120x120?text=No+Image" alt="No Image Available" class="clickable-image" data-product-id="{{ item.product_id }}" title="View product details">
                    {% endif %}
                  </div>

                    <style>
                      /* Ensure desktop cart images always render at expected size */
                      .cart-container.desktop-cart .product-image-container { width:72px; height:72px; }
                      .cart-container.desktop-cart .product-image-container img { width:72px !important; height:72px !important; object-fit:cover !important; display:block !important; }
                    </style>

                    <script>
                      // Normalize cart images: if the src is a relative storage path like 'products/123.jpg'
                      // prefix it with '/media/' so the browser can load it. Also ensure image sizing.
                      document.addEventListener('DOMContentLoaded', function() {
                        try {
                          const imgs = document.querySelectorAll('.cart-container.desktop-cart .product-image-container img');
                          imgs.forEach(img => {
                            if (!img) return;
                            const src = (img.getAttribute('src') || '').trim();
                            if (!src) {
                              // set placeholder if no src
                              img.src = 'https://via.placeholder.com/72?text=No+Image';
                              return;
                            }

                            // If src already looks like an absolute URL or starts with /static or /media, leave it
                            if (/^(https?:)?\//i.test(src) || src.startsWith('data:')) {
                              // ensure size
                              img.style.width = '72px';
                              img.style.height = '72px';
                              img.style.objectFit = 'cover';
                              return;
                            }

                            // Otherwise assume it's a storage-relative path and prefix with /media/
                            img.src = '/media/' + src.replace(/^\//, '');
                            img.style.width = '72px';
                            img.style.height = '72px';
                            img.style.objectFit = 'cover';
                          });
                        } catch (e) {
                          console.warn('Cart image normalization failed', e);
                        }
                      });
                    </script>
                  <div class="product-details">
                    <h3 class="product-title">{{ item.name }}</h3>
                    <div class="product-specs">
                      Condition: {{ item.condition|default:"N/A" }}<br>
                      Category: {{ item.category|default:"Uncategorized" }}
                    </div>
                    <div class="product-actions">
                      <button class="remove-btn" data-product-id="{{ item.product_id }}">
                        <i class="far fa-trash-alt"></i> Remove
                      </button>
                      <button class="save-btn clickable-image" data-product-id="{{ item.product_id }}" title="View product details">
                        <i class="far fa-heart"></i> Product Detail
                      </button>
                    </div>
                  </div>
                  <div class="quantity-control">
                    <button class="quantity-btn" data-action="decrease" data-product-id="{{ item.product_id }}">-</button>
                    <span class="quantity-value">{{ item.quantity }}</span>
                    <button class="quantity-btn" data-action="increase" data-product-id="{{ item.product_id }}">+</button>
                  </div>
                  <div class="product-price">
                    $<strong><span class="item-total">{{ item.total_price|floatformat:2 }}</span></strong>
                  </div>
                </div>
              {% endfor %}
            {% else %}
              <p>Your cart is empty.</p>
            {% endif %}
          </div>

          <div class="cart-summary-section">
            <!-- WRAP FORM HERE Send information to the history page-->
            <form method="POST" action="{% url 'checkout' %}">
              {% csrf_token %}

              <div class="summary-card">
                <h3>Order Summary</h3>

                <div class="summary-row">
                  <span>Subtotal (<span class="total-items">{{ cart_items|length }}</span> items)</span>
                  <span>$<span class="subtotal-amount">{{ subtotal }}</span></span>
                </div>

                <div class="summary-row">
                  <span>Tax (15%)</span>
                  <span>$<span class="tax-amount">{{ taxes }}</span></span>
                </div>

                <button type="submit" class="checkout-btn">Proceed to Checkout</button>
                <div class="payment-methods">
                  <i class="fab fa-cc-visa"></i>
                  <i class="fab fa-cc-mastercard"></i>
                  <i class="fab fa-cc-amex"></i>
                  <i class="fab fa-cc-paypal"></i>
                </div>
              </div>

              <div class="customer-info-card">
                <h3>Customer Information</h3>
                
                <div class="form-group">
                  <label for="fullname">Full Name</label><br>
                  <input style="width: 100%;" type="text" name="fullname" id="fullname" placeholder="John Doe" class="modern-select" required>
                </div>

                <div class="form-group">
                  <label for="phone">Phone Number</label><br>
                  <input style="width: 100%;" type="tel" name="phone" id="phone" placeholder="+263 771 234 567" class="modern-select" required>
                </div>

                <div class="form-group">
                  <label for="email">Email</label><br>
                  <input style="width: 100%;" type="email" name="email" id="email" placeholder="john@gmail.com" class="modern-select" required>
                </div>

                <div class="summary-row-select-city">
                  
                  <label for="delivery-location" class="dropdown-label">Select City</label><br>
                  <select style="width: 100%;" id="delivery-location" name="delivery_location" class="modern-select" required>
                    <option value="">Select your location</option>
                    <option value="harare">Harare</option>
                    <option value="bulawayo">Bulawayo</option>
                    <option value="mutare">Mutare</option>
                    <option value="gweru">Gweru</option>
                    <option value="masvingo">Masvingo</option>
                    <option value="kadoma">Kadoma</option>
                    <option value="kwekwe">Kwekwe</option>
                    <option value="marondera">Marondera</option>
                    <option value="chegutu">Chegutu</option>
                    <option value="bindura">Bindura</option>
                    <option value="chipinge">Chipinge</option>
                    <option value="chinhoyi">Chinhoyi</option>
                    <option value="mutoko">Mutoko</option>
                    <option value="ruwa">Ruwa</option>
                    <option value="checheche">Checheche</option>
                    <option value="masvingo town">Masvingo Town</option>
                    <option value="shurugwi">Shurugwi</option>
                    <option value="redcliff">Redcliff</option>
                    <option value="gokwe">Gokwe</option>
                    <option value="beitbridge">Beitbridge</option>
                    <option value="chisumbanje">Chisumbanje</option>
                    <option value="murewa">Murewa</option>
                    <option value="maramba">Maramba</option>
                    <option value="esigodini">Esigodini</option>
                    <option value="zvishavane">Zvishavane</option>
                    <option value="mutare suburbs">Mutare Suburbs</option>
                    <option value="harare suburbs">Harare Suburbs</option>
                    <option value="bulawayo suburbs">Bulawayo Suburbs</option>
                  </select>
                </div>

                <div class="form-group">
                  <label for="address">Shipping Address</label><br>
                  <textarea style="width: 100%;" name="address" id="address" rows="3" placeholder="123 Main St, Apt 4B&#10;New York, NY 10001" class="modern-select" required></textarea>
                </div>

                <!-- line for totals and delivery cost -->
                <div class="line mt-3 mb-1"></div>
                <style>
                  .line {
                    width: 100%;                /* thickness */
                    height: 2px;             /* how tall */
                    background-color: black;   /* line color */
                  }
                </style>

                <div class="summary-row">
                  <span>Delivery Cost</span>
                  <span class="total-price">$<span id="delivery-cost-amount">{{ delivery_cost|default:"0.00" }}</span></span>
                </div>

                <div class="summary-row">
                  <span>Total</span>
                  <span class="total-price">$<span id="grand-total-amount">{{ total|default:"0.00" }}</span></span>
                </div>

                <!-- line for totals and delivery cost -->
                <div class="line mb-3 mt-2"></div>
                <style>
                  .line {
                    width: 100%;                /* thickness */
                    height: 2px;             /* how tall */
                    background-color: black;   /* line color */
                  }
                </style>

                <!-- Hidden input to submit delivery cost with the checkout form -->
                <input type="hidden" name="delivery_cost" id="delivery_cost_input" value="{{ delivery_cost|default:"0.00" }}">

                <div class="form-group">
                  <label for="notes">Delivery Notes (Optional)</label><br>
                  <textarea style="width: 100%;" name="notes" id="notes" rows="2" placeholder="Leave at front door if I'm not home" class="modern-select"></textarea>
                </div>
              </div>
            </form>
            <!-- END FORM -->
          </div>
        </div>
      </main>
    </div>
  </div>


  <script>document.querySelectorAll('.quantity-btn').forEach(button => {
    button.addEventListener('click', function() {
      const action = this.getAttribute('data-action');
      const productId = this.getAttribute('data-product-id');
      const quantityElement = this.parentElement.querySelector('.quantity-value');
      let quantity = parseInt(quantityElement.textContent);

      if (action === 'increase') {
        quantity++;
      } else if (action === 'decrease' && quantity > 1) {
        quantity--;
      }

      // Send update to backend
      fetch('/update-cart-quantity/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded',
          'X-CSRFToken': getCookie('csrftoken')  // Make sure you add a CSRF helper
        },
        body: `product_id=${productId}&quantity=${quantity}`
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          quantityElement.textContent = quantity;
          // Update item total price
          const itemCard = button.closest('.cart-item-card');
          const itemTotal = itemCard.querySelector('.item-total');
          itemTotal.textContent = data.item_total;
          // Update cart summary totals
          document.querySelector('.subtotal-amount').textContent = data.subtotal;
          document.querySelector('.tax-amount').textContent = data.taxes;
          document.querySelector('.total-amount').textContent = data.total;
        } else {
          alert('Failed to update cart: ' + data.error);
        }
      })
      .catch(() => alert('Failed to update cart. Please try again.'));
    });
  });

  // CSRF helper function
  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
      const cookies = document.cookie.split(';');
      for (let cookie of cookies) {
        cookie = cookie.trim();
        if (cookie.startsWith(name + '=')) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }

  </script>

  <!-- Realtime updates client -->
  <script src="{% static 'website/js/realtime.js' %}"></script>
  <script src="{% static 'website/js/product_carousel_init.js' %}"></script>
    <script>
    // Called after AJAX replaces `#productList` so any dynamic widgets are re-initialized
    window.initializeProductCarousels = function () {
      // product_carousel_init.js may define an init function; otherwise re-run any needed setup
      try {
        if (typeof initProductCarousels === 'function') initProductCarousels();
      } catch (e) { console.warn('carousel init failed', e); }
    };
    // CSRF helper function
    function getCookie(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let cookie of cookies) {
          cookie = cookie.trim();
          if (cookie.startsWith(name + '=')) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      return cookieValue;
    }

    // Render cart data into the DOM
    function renderCart(data) {
      const cartItemsSection = document.querySelector('.cart-items-section');
      if (!cartItemsSection) return;
      cartItemsSection.innerHTML = ''; // clear current

      data.cart_items.forEach(item => {
        const itemHTML = `
            <div class="cart-item-card" data-product-id="${item.product_id}">
              <div class="product-image-container">
                <img src="${item.image || 'https://via.placeholder.com/120x120?text=No+Image'}" alt="${item.name}" class="clickable-image" data-product-id="${item.product_id}" title="View product details">
              </div>
              <div class="product-details">
                <h3 class="product-title">${item.name}</h3>
                <div class="product-specs">
                  Condition: ${item.condition || 'N/A'}<br>
                  Category: ${item.category || 'Uncategorized'}
                </div>
                <div class="product-actions">
                  <button class="remove-btn" data-product-id="${item.product_id}">
                    <i class="far fa-trash-alt"></i> Remove
                  </button>
                  <button class="save-btn clickable-image" data-product-id="${item.product_id}" title="View product details">
                    <i class="far fa-heart"></i> Product Detail
                  </button>
                </div>
              </div>
              <div class="quantity-control">
                <button class="quantity-btn" data-action="decrease" data-product-id="${item.product_id}">-</button>
                <span class="quantity-value">${item.quantity}</span>
                <button class="quantity-btn" data-action="increase" data-product-id="${item.product_id}">+</button>
              </div>
              <div class="product-price">
                $<strong><span class="item-total">${item.total_price.toFixed(2)}</span></strong>
              </div>
            </div>
          `;
        cartItemsSection.insertAdjacentHTML('beforeend', itemHTML);
      });

      // Update summary
      document.querySelector('.subtotal-amount').textContent = data.subtotal;
      document.querySelector('.tax-amount').textContent = data.taxes;
  // update totals (subtotal/tax) and then recalc grand total including delivery
  document.querySelectorAll('.total-amount').forEach(el => el.textContent = data.total);
      document.querySelector('.total-items').textContent = data.total_items;

      // Update header cart count badge in real time
      try {
        const cartBadge = document.getElementById('cart-count');
        if (cartBadge) {
          cartBadge.textContent = data.total_items || 0;
          cartBadge.style.display = data.total_items && data.total_items > 0 ? 'inline-block' : 'none';
        }
      } catch (e) { /* ignore if element not present */ }

      bindQuantityButtons(); // Re-bind quantity buttons after re-render
      bindRemoveButtons(); // Bind remove buttons if you implement remove API
      // Recalculate grand total with current delivery cost
      recalcGrandTotal();
    }

    // Fetch and update cart UI
    function fetchCartData() {
      fetch('/api/cart/')
        .then(res => res.json())
        .then(data => {
          // update badge even when cart panel isn't open
          try {
            const cartBadge = document.getElementById('cart-count');
            if (cartBadge) {
              cartBadge.textContent = data.total_items || 0;
              cartBadge.style.display = data.total_items && data.total_items > 0 ? 'inline-block' : 'none';
            }
          } catch (e) {}
          renderCart(data);
        })
        .catch(console.error);
    }

    // Delivery cost lookup (local map). Values are currency units matching subtotal (assumes USD strings used in template)
    const DELIVERY_COSTS = {
      'harare': 5,
      'harare suburbs': 7,
      'bulawayo': 6,
      'bulawayo suburbs': 8,
      'mutare': 7,
      'gweru': 6,
      'masvingo': 7,
      'masvingo town': 8,
      'kadoma': 6,
      'kwekwe': 6,
      'marondera': 5,
      'chegutu': 5,
      'bindura': 6,
      'chipinge': 7,
      'chinhoyi': 5,
      'mutoko': 6,
      'ruwa': 5,
      'checheche': 5,
      'shurugwi': 6,
      'redcliff': 5,
      'gokwe': 8,
      'beitbridge': 10,
      'chisumbanje': 9,
      'murewa': 6,
      'maramba': 7,
      'esigodini': 6,
      'zvishavane': 8
    };

    // Parse currency-like numeric strings robustly
    function parseAmount(v) {
      if (typeof v === 'number') return v;
      if (!v) return 0;
      return parseFloat(String(v).replace(/[^0-9.-]+/g, '')) || 0;
    }

    function recalcGrandTotal() {
      const subtotalEl = document.querySelector('.subtotal-amount');
      const taxEl = document.querySelector('.tax-amount');
      const deliveryEl = document.getElementById('delivery-cost-amount');
      const grandEl = document.getElementById('grand-total-amount');
      const inputEl = document.getElementById('delivery_cost_input');

      const subtotal = parseAmount(subtotalEl ? subtotalEl.textContent : 0);
      const tax = parseAmount(taxEl ? taxEl.textContent : 0);
      const delivery = parseAmount(deliveryEl ? deliveryEl.textContent : 0);

      const grand = (subtotal + tax + delivery);
      if (grandEl) grandEl.textContent = grand.toFixed(2);
      if (inputEl) inputEl.value = delivery.toFixed(2);
    }

    // When delivery location changes, update delivery cost and recalc
    document.addEventListener('change', (e) => {
      if (e.target && e.target.id === 'delivery-location') {
        const loc = (e.target.value || '').toLowerCase();
        const cost = DELIVERY_COSTS[loc] !== undefined ? DELIVERY_COSTS[loc] : 0;
        const deliveryCostEl = document.getElementById('delivery-cost-amount');
        if (deliveryCostEl) deliveryCostEl.textContent = cost.toFixed(2);
        const inputEl = document.getElementById('delivery_cost_input');
        if (inputEl) inputEl.value = cost.toFixed(2);
        recalcGrandTotal();
      }
    });

    // Ensure grand total is recalculated on page load after cart fetch
    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(recalcGrandTotal, 300);
    });

    // Send quantity update to backend and refresh cart on success
    function updateQuantity(productId, quantity) {
      fetch('/update-cart-quantity/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded',
          'X-CSRFToken': getCookie('csrftoken'),
        },
        body: `product_id=${productId}&quantity=${quantity}`
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          fetchCartData(); // refresh cart with updated data
        } else {
          alert('Failed to update cart: ' + data.error);
        }
      })
      .catch(() => alert('Failed to update cart. Please try again.'));
    }

    // Attach event listeners to quantity buttons
    function bindQuantityButtons() {
      document.querySelectorAll('.quantity-btn').forEach(button => {
        button.onclick = () => {
          const action = button.getAttribute('data-action');
          const productId = button.getAttribute('data-product-id');
          const quantityElement = button.parentElement.querySelector('.quantity-value');
          let quantity = parseInt(quantityElement.textContent);

          if (action === 'increase') quantity++;
          else if (action === 'decrease' && quantity > 1) quantity--;

          updateQuantity(productId, quantity);
        };
      });
    }

    // Attach event listeners to remove buttons and call server remove endpoint
    function bindRemoveButtons() {
      document.querySelectorAll('.remove-btn').forEach(button => {
        button.onclick = () => {
          const productId = button.getAttribute('data-product-id');
          // Use the existing Django URL: /cart/remove/<product_id>/
          fetch(`/cart/remove/${productId}/`, {
            method: 'POST',
            headers: {
              'X-CSRFToken': getCookie('csrftoken'),
            }
          })
          .then(res => res.json())
          .then(data => {
            if (data.success) {
              // Update summary fields from response if present
              if (data.subtotal !== undefined) {
                document.querySelector('.subtotal-amount').textContent = data.subtotal;
              }
              if (data.taxes !== undefined) {
                document.querySelector('.tax-amount').textContent = data.taxes;
              }
              if (data.total !== undefined) {
                document.querySelectorAll('.total-amount').forEach(el => el.textContent = data.total);
              }
              if (data.total_items !== undefined) {
                document.querySelectorAll('.total-items').forEach(el => el.textContent = data.total_items);
                const cartBadge = document.getElementById('cart-count');
                if (cartBadge) {
                  cartBadge.textContent = data.total_items || 0;
                  cartBadge.style.display = data.total_items && data.total_items > 0 ? 'inline-block' : 'none';
                }
              }

              // Remove the item card from DOM
              const itemCard = button.closest('.cart-item-card');
              if (itemCard) itemCard.remove();
            } else {
              alert('Failed to remove item');
            }
          })
          .catch(() => alert('Failed to remove item. Please try again.'));
        };
      });
    }

    // On page load, fetch cart and start polling every 5 seconds
    document.addEventListener('DOMContentLoaded', () => {
      fetchCartData();
      setInterval(fetchCartData, 2000);
    });
  </script>

  <!--orderPlaced.html must work this code
  this is the pag that shows the products purchased like not yrt delivered to the customer-->
  <div id="cartContents" class="order-history-section" style="display: none;">
    <div class="order-history-container">
      {% if orders %}
      <div class="order-history-header">
        <h1>Your Orders</h1>
        <p class="order-history-subtitle">
          Keep track of your orders with ease. View past orders, check delivery statuses, 
          and get quick access to order details.
        </p>
      </div>

      <!-- Order Summary -->
      <div class="order-summary-card">
        <div class="order-summary-grid">
          <!-- Order Placed -->
          <div class="order-stat">
            <div class="stat-label">
              <i class="bi bi-calendar-check"></i> Order Placed
            </div>
            <div class="stat-value">{{ today_date }}</div>
          </div>

          <!-- Total -->
          <div class="order-stat">
            <div class="stat-label">
              <i class="bi bi-currency-dollar"></i> Total
            </div>
            <div class="stat-value">${{ total_price|floatformat:2 }}</div>
          </div>

          <!-- Shipped To -->
          <div class="order-stat">
            <div class="stat-label">
              <i class="bi bi-truck"></i> Shipping To
            </div>
            <div class="stat-value">{{ orders.0.first_name }} {{ orders.0.last_name }}</div>
          </div>

          <!-- Order Number -->
          <div class="order-stat">
            <div>
              <div class="stat-label">Order #</div>
              <div class="order-number">{{ orders.0.id }}</div>
            </div>
          </div>
        </div>
      </div>

      {% for order in orders %}
      <div class="order-card">
        <!-- Delivery Status -->
        <div class="order-status-bar">
            <div class="delivery-status">
            <span class="status-badge delivered" style="color: #b4441a;">
              <i class="bi bi-check-circle-fill"></i>  To be Delivered
            </span>
            <span class="delivery-date">on {{ order.expected_delivery_date|date:"F j, Y" }}</span>
          </div>
          <div class="delivery-method">
            <i class="bi bi-check-circle-fill"></i> Will be delivered to the location you have provided
          </div>
        </div>

        <div class="order-details-grid">
          <!-- Product Image -->
          <div class="order-product-image">
            {% if order.image %}
              {% if order.product_id %}
                <img src="{{ order.image.url }}" alt="{{ order.product }}" class="clickable-image" data-product-id="{{ order.product_id }}" title="View product details">
              {% else %}
                <img src="{{ order.image.url }}" alt="{{ order.product }}">
              {% endif %}
            {% else %}
              {% if order.product_id %}
                <img src="https://via.placeholder.com/120?text=No+Image" alt="No image" class="clickable-image" data-product-id="{{ order.product_id }}" title="View product details">
              {% else %}
                <img src="https://via.placeholder.com/120?text=No+Image" alt="No image">
              {% endif %}
            {% endif %}
          </div>

          <!-- Product Details -->
          <div class="order-product-info">
            <h3>{{ order.product }}</h3>
            <div class="product-specs">
              <div><strong>Quantity:</strong> {{ order.quantity }}</div>
              <div><strong>Price:</strong> ${{ order.price|floatformat:2 }}</div>
              <div><strong>Total:</strong> ${{ order.total|floatformat:2 }}</div>
            </div>

            <div class="product-actions">
              <button class="buy-again-btn" id="Buy_Again">
                <i class="bi bi-repeat"></i> Buy Again
              </button>
              {% if order.product_id %}
                <button class="view-item-btn clickable-image" data-product-id="{{ order.product_id }}" title="View product details">
                  <i class="bi bi-eye"></i> Product Detail
                </button>
              {% else %}
                <button class="view-item-btn">
                  <i class="bi bi-eye"></i> Product Detail
                </button>
              {% endif %}
            </div>
          </div>

          <!-- Order Actions -->
          <div class="order-management-actions">
            <button class="track-package-btn">
              <i class="bi bi-truck"></i> Track Package
            </button>
            <button class="return-item-btn">
              <i class="bi bi-arrow-return-left"></i> Correct Details
            </button>
          </div>
        </div>
      </div>
      {% endfor %}

      {% else %}
      <div class="empty-order-history">
        <i class="bi bi-cart-x"></i>
        <h3>Your order history is empty</h3>
        <p>When you place orders, they'll appear here</p>
        <a href="{% url 'home' %}" class="continue-shopping-btn">
          <i class="bi bi-arrow-left"></i> Continue Shopping
        </a>
      </div>
      {% endif %}
    </div>
  </div>

  <!--history.html must work this code
  this is the page that shows all the client history-->
  <div id="HistoryContents" class="order-history-section" style="display: none;">
    <div class="order-history-container">
      {% if orders %}
      <div class="order-history-header">
        <h1>Your Orders</h1>
        <p class="order-history-subtitle">
          Keep track of your orders with ease. View past orders, check delivery statuses, 
          and get quick access to order details.
        </p>
      </div>

      <!-- Order Summary -->
      <div class="order-summary-card">
        <div class="order-summary-grid">
          <!-- Order Placed -->
          <div class="order-stat">
            <div class="stat-label">
              <i class="bi bi-calendar-check"></i> Order Placed
            </div>
            <div class="stat-value">{{ today_date }}</div>
          </div>

          <!-- Total -->
          <div class="order-stat">
            <div class="stat-label">
              <i class="bi bi-currency-dollar"></i> Total
            </div>
            <div class="stat-value">${{ total_price|floatformat:2 }}</div>
          </div>

          <!-- Shipped To -->
          <div class="order-stat">
            <div class="stat-label">
              <i class="bi bi-truck"></i> Shipped To
            </div>
            <div class="stat-value">{{ orders.0.first_name }} {{ orders.0.last_name }}</div>
          </div>

          <!-- Order Number -->
          <div class="order-stat">
            <div>
              <div class="stat-label">Total Orders</div>
              <div class="order-number">{{ orders.0.id }}</div>
            </div>
          </div>
        </div>
      </div>

      {% for order in orders %}
      <div class="order-card">
        <!-- Delivery Status -->
        <div class="order-status-bar">
          <div class="delivery-status">
            {% if order.delivery_status|lower == "delivered" %}
              <span class="status-badge delivered" style="color: #08a855;">
                <i class="bi bi-check-circle-fill"></i> Delivered
              </span>
              <span class="delivery-date"> Placed On: on {{ order.expected_delivery_date|date:"F j, Y" }}</span>
            {% elif order.delivery_status|lower == "shipped" %}
              <span class="status-badge delivered" style="color: #d92199;">
                <i class="bi bi-check-circle-fill"></i> In Transit
              </span>
              <span class="delivery-date"> Placed On: on {{ order.expected_delivery_date|date:"F j, Y" }}</span>
            {% else %}
              <span class="status-badge pending" style="color: #ff9800;">
                <i class="bi bi-clock-fill"></i> To be Delivered
              </span>
              <span class="delivery-date"> Placed On: {{ order.expected_delivery_date|date:"F j, Y" }}</span>
            {% endif %}

          </div>
          {% if order.delivery_status|lower == "delivered" %}
            <div class="delivery-method" style="color: #045a12;">
              <i class="bi bi-check-circle-fill"></i>
              {% if order.delivery_notes %}
                {{ order.delivery_notes }}
              {% else %}
                No delivey not added.
              {% endif %}
            </div>
          {% elif order.delivery_status|lower == "shipped" %}
            <div class="delivery-method" style="color: #d92199;">
              <i class="bi bi-check-circle-fill"></i>
              Shipped and on the move.
            </div>
          {% elif order.delivery_status|lower == "pending" %}
            <div class="delivery-method" style="color: #ff9800;">
              <i class="bi bi-check-circle-fill"></i>
              Your order is in the queue and will be processed soon.
            </div>
          {% endif %}
        </div>

        <div class="order-details-grid">
          <!-- Product Image -->
          <div class="order-product-image">
            {% if order.image %}
              {% if order.product_id %}
                <img src="{{ order.image.url }}" alt="{{ order.product }}" class="clickable-image" data-product-id="{{ order.product_id }}" title="View product details">
              {% else %}
                <img src="{{ order.image.url }}" alt="{{ order.product }}">
              {% endif %}
            {% else %}
              {% if order.product_id %}
                <img src="https://via.placeholder.com/120?text=No+Image" alt="No image" class="clickable-image" data-product-id="{{ order.product_id }}" title="View product details">
              {% else %}
                <img src="https://via.placeholder.com/120?text=No+Image" alt="No image">
              {% endif %}
            {% endif %}
          </div>

          <!-- Product Details -->
          <div class="order-product-info">
            <h3>{{ order.product }}</h3>
            <div class="product-specs">
              
            </div>

            <div class="product-actions">

              <div><strong>Quantity:</strong> {{ order.quantity }}</div>
              <div><strong>Price:</strong> ${{ order.price|floatformat:2 }}</div>
              <div><strong>Total:</strong> ${{ order.total|floatformat:2 }}</div>

            </div>
            <div class="product-actions mt-3">
              {% if order.product_id %}
                <button class="view-item-btn clickable-image" data-product-id="{{ order.product_id }}" title="View product details">
                  <i class="bi bi-eye"></i> Product Detail
                </button>
              {% else %}
                <button class="view-item-btn">
                  <i class="bi bi-eye"></i> Product Detail
                </button>
              {% endif %}
            </div>
          </div>

          <!-- Order Actions -->
          <div class="order-management-actions">
            <button class="remove-item-btn btn btn-outline-danger" data-order-id="{{ order.id }}">
              <i class="bi bi-trash"></i> Remove
            </button>
          </div>
        </div>
      </div>
      {% endfor %}

      {% else %}
      <div class="empty-order-history">
        <i class="bi bi-cart-x"></i>
        <h3>Your order history is empty</h3>
        <p>When you place orders, they'll appear here</p>
        <a href="{% url 'home' %}" class="continue-shopping-btn">
          <i class="bi bi-arrow-left"></i> Continue Shopping
        </a>
      </div>
      {% endif %}
    </div>
  </div>

  <!--this is about us page that will show information about the company-->
  <div id="about_us_page" style="display: none;">
    <!-- Hero Section with Animated Background -->
    <section class="hero-section">
        <div class="animated-tech-bg"></div>
        <div class="container hero-content">
            <div class="row align-items-center gx-5">
                <div class="col-lg-6 order-lg-1 order-2">
                    <h1 class="display-3 fw-bold mb-4 animate-on-scroll" data-animation="fadeInUp">Empowering Zimbabwe's <span class="text-gradient">Digital Future</span></h1>
                    <p class="lead mb-4 fs-5 animate-on-scroll" data-animation="fadeInUp" data-delay="100">Your trusted partner for cutting-edge technology solutions in Harare. We bring innovation, reliability, and expertise to power your digital transformation.</p>
                    <div class="d-flex gap-3 animate-on-scroll" data-animation="fadeInUp" data-delay="200">
                        <a href="#contact" class="btn btn-primary btn-lg px-4 btn-hover-effect">Get in Touch</a>
                        <a href="#services" class="btn btn-outline-dark btn-lg px-4 btn-hover-effect">Explore Services</a>
                    </div>
                </div>
                <div class="col-lg-6 order-lg-2 order-1 mb-4 mb-lg-0 animate-on-scroll mt-4" data-animation="fadeIn">
                    <div class="hero-image-container">
                        <img src="https://placehold.co/600x600/3b82f6/white?text=Lion+Tech" alt="Lion Tech Showroom" class="img-fluid rounded-4 shadow-lg hero-main-image">
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Our Story with Modern Layout -->
    <section class="py-7">
        <div class="container">
            <div class="row gx-5 align-items-center">
                <div class="col-lg-6 mb-5 mb-lg-0">
                    <div class="story-media-container">
                        <div class="ratio ratio-16x9 rounded-4 overflow-hidden shadow-lg mb-4">
                            <iframe class="rounded-4" src="https://www.youtube.com/embed/placeholder" title="About Lion Tech" allowfullscreen></iframe>
                        </div>
                        <div class="d-flex justify-content-center gap-3">
                            <div class="media-badge">
                                <i class="bi bi-people-fill me-2"></i>25+ Experts
                            </div>
                            <div class="media-badge">
                                <i class="bi bi-building me-2"></i>3 Locations
                            </div>
                            <div class="media-badge">
                                <i class="bi bi-check-circle-fill me-2"></i>8 Years Experience
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="ps-lg-5">
                        <span class="section-subtitle text-primary fw-bold animate-on-scroll" data-animation="fadeInUp">OUR STORY</span>
                        <h2 class="display-5 fw-bold mb-4 animate-on-scroll" data-animation="fadeInUp">From Humble Beginnings to Tech Leaders</h2>
                        <p class="lead mb-4 animate-on-scroll" data-animation="fadeInUp">Founded in 2015 in Harare, Lion Tech Zimbabwe has grown from a small computer repair shop to a leading technology provider in the region.</p>
                        
                        <div class="story-timeline animate-on-scroll" data-animation="fadeInUp">
                            <div class="timeline-item">
                                <div class="timeline-marker"></div>
                                <div class="timeline-content">
                                    <h5 class="fw-bold">2015 - The Beginning</h5>
                                    <p>Started with just 2 employees in a small workshop, focusing on computer repairs and maintenance.</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-marker"></div>
                                <div class="timeline-content">
                                    <h5 class="fw-bold">2017 - First Retail Space</h5>
                                    <p>Opened our first retail location on Jason Moyo Avenue, expanding our product offerings.</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-marker"></div>
                                <div class="timeline-content">
                                    <h5 class="fw-bold">2023 - Current Success</h5>
                                    <p>Now serving over 5,000 customers with a team of 25 tech experts across multiple locations.</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4 animate-on-scroll" data-animation="fadeInUp">
                            <a href="#" class="btn btn-outline-primary btn-hover-effect">Read Full Story</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Stats Section -->
    <section class="py-6 bg-light-gradient">
        <div class="container">
            <div class="row g-4">
                <div class="col-md-3 col-6">
                    <div class="stat-card animate-on-scroll" data-animation="fadeInUp">
                        <div class="stat-icon bg-primary-light">
                            <i class="bi bi-people-fill text-primary"></i>
                        </div>
                        <h3 class="stat-number" data-count="5000">0</h3>
                        <p class="stat-label">Happy Customers</p>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="stat-card animate-on-scroll" data-animation="fadeInUp" data-delay="100">
                        <div class="stat-icon bg-secondary-light">
                            <i class="bi bi-check-circle-fill text-secondary"></i>
                        </div>
                        <h3 class="stat-number" data-count="8">0</h3>
                        <p class="stat-label">Years Experience</p>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="stat-card animate-on-scroll" data-animation="fadeInUp" data-delay="200">
                        <div class="stat-icon bg-success-light">
                            <i class="bi bi-tools text-success"></i>
                        </div>
                        <h3 class="stat-number" data-count="12000">0</h3>
                        <p class="stat-label">Devices Repaired</p>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="stat-card animate-on-scroll" data-animation="fadeInUp" data-delay="300">
                        <div class="stat-icon bg-warning-light">
                            <i class="bi bi-award-fill text-warning"></i>
                        </div>
                        <h3 class="stat-number" data-count="15">0</h3>
                        <p class="stat-label">Industry Awards</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Our Services with Modern Cards -->
    <section id="services" class="py-7">
        <div class="container">
            <div class="text-center mb-7">
                <span class="section-subtitle text-primary fw-bold animate-on-scroll" data-animation="fadeInUp">OUR SERVICES</span>
                <h2 class="display-5 fw-bold mb-3 animate-on-scroll" data-animation="fadeInUp">Comprehensive Tech Solutions</h2>
                <p class="lead mx-auto animate-on-scroll" data-animation="fadeInUp" style="max-width: 700px;">We offer end-to-end technology services to meet all your digital needs, from hardware to software solutions.</p>
            </div>
            
            <div class="row g-4">
                <div class="col-lg-4 col-md-6">
                    <div class="service-card animate-on-scroll" data-animation="fadeInUp">
                        <div class="service-icon bg-primary-light">
                            <i class="bi bi-laptop text-primary"></i>
                        </div>
                        <h3>Computer Sales</h3>
                        <p>Latest laptops, desktops, and accessories from top brands with competitive pricing and warranty.</p>
                        <a href="#" class="service-link">Explore Options <i class="bi bi-arrow-right"></i></a>
                        <div class="service-hover-bg"></div>
                    </div>
                </div>
                <div class="col-lg-4 col-md-6">
                    <div class="service-card animate-on-scroll" data-animation="fadeInUp" data-delay="100">
                        <div class="service-icon bg-secondary-light">
                            <i class="bi bi-phone text-secondary"></i>
                        </div>
                        <h3>Mobile Devices</h3>
                        <p>Smartphones, tablets, and wearables from leading manufacturers with local support.</p>
                        <a href="#" class="service-link">View Devices <i class="bi bi-arrow-right"></i></a>
                        <div class="service-hover-bg"></div>
                    </div>
                </div>
                <div class="col-lg-4 col-md-6">
                    <div class="service-card animate-on-scroll" data-animation="fadeInUp" data-delay="200">
                        <div class="service-icon bg-success-light">
                            <i class="bi bi-tools text-success"></i>
                        </div>
                        <h3>Repair Services</h3>
                        <p>Expert repair for all devices with quick turnaround times and transparent diagnostics.</p>
                        <a href="#" class="service-link">Book Repair <i class="bi bi-arrow-right"></i></a>
                        <div class="service-hover-bg"></div>
                    </div>
                </div>
                <div class="col-lg-4 col-md-6">
                    <div class="service-card animate-on-scroll" data-animation="fadeInUp">
                        <div class="service-icon bg-info-light">
                            <i class="bi bi-hdd-network text-info"></i>
                        </div>
                        <h3>Networking</h3>
                        <p>Complete networking solutions for homes and businesses with professional installation.</p>
                        <a href="#" class="service-link">Get Quote <i class="bi bi-arrow-right"></i></a>
                        <div class="service-hover-bg"></div>
                    </div>
                </div>
                <div class="col-lg-4 col-md-6">
                    <div class="service-card animate-on-scroll" data-animation="fadeInUp" data-delay="100">
                        <div class="service-icon bg-warning-light">
                            <i class="bi bi-shield-check text-warning"></i>
                        </div>
                        <h3>IT Support</h3>
                        <p>Professional IT services including system setup, maintenance, and security solutions.</p>
                        <a href="#" class="service-link">Learn More <i class="bi bi-arrow-right"></i></a>
                        <div class="service-hover-bg"></div>
                    </div>
                </div>
                <div class="col-lg-4 col-md-6">
                    <div class="service-card animate-on-scroll" data-animation="fadeInUp" data-delay="200">
                        <div class="service-icon bg-danger-light">
                            <i class="bi bi-headset text-danger"></i>
                        </div>
                        <h3>Consultation</h3>
                        <p>Expert advice to help you choose the right technology solutions for your specific needs.</p>
                        <a href="#" class="service-link">Schedule Call <i class="bi bi-arrow-right"></i></a>
                        <div class="service-hover-bg"></div>
                    </div>
                </div>
            </div>
            
            <div class="text-center mt-6 animate-on-scroll" data-animation="fadeInUp">
                <a href="#" class="btn btn-primary btn-lg px-5 btn-hover-effect">View All Services</a>
            </div>
        </div>
    </section>

    <!-- Contact Section with Modern Layout -->
    <section id="contact" class="py-7">
        <div class="container">
            <div class="row g-5">
                <div class="col-lg-5">
                    <div class="contact-info-wrapper">
                        <span class="section-subtitle text-primary fw-bold animate-on-scroll" data-animation="fadeInUp">CONTACT US</span>
                        <h2 class="display-5 fw-bold mb-4 animate-on-scroll" data-animation="fadeInUp">Let's Talk About Your Tech Needs</h2>
                        <p class="lead mb-5 animate-on-scroll" data-animation="fadeInUp">Whether you have questions about our services or need technical support, our team is ready to help.</p>
                        
                        <div class="contact-info-card animate-on-scroll" data-animation="fadeInUp">
                            <div class="contact-info-item">
                                <div class="contact-icon bg-primary-light">
                                    <i class="bi bi-geo-alt-fill text-primary"></i>
                                </div>
                                <div>
                                    <h5 class="mb-1">Our Location</h5>
                                    <p class="mb-0">Stanley House, Jason Moyo Ave & First St, Harare, Zimbabwe</p>
                                </div>
                            </div>
                            
                            <div class="contact-info-item">
                                <div class="contact-icon bg-secondary-light">
                                    <i class="bi bi-telephone-fill text-secondary"></i>
                                </div>
                                <div>
                                    <h5 class="mb-1">Call Us</h5>
                                    <p class="mb-0">+263 713123084</p>
                                    <small class="text-muted">Mon-Fri, 8:30am-4:00pm</small>
                                </div>
                            </div>
                            
                            <div class="contact-info-item">
                                <div class="contact-icon bg-success-light">
                                    <i class="bi bi-envelope-fill text-success"></i>
                                </div>
                                <div>
                                    <h5 class="mb-1">Email Us</h5>
                                    <p class="mb-0">sales@liontech.co.zw</p>
                                    <small class="text-muted">Response within 24 hours</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-5 animate-on-scroll" data-animation="fadeInUp">
                            <h5 class="mb-3">Follow Us</h5>
                            <div class="d-flex gap-3">
                                <a href="#" class="social-icon-circle bg-facebook">
                                    <i class="bi bi-facebook"></i>
                                </a>
                                <a href="#" class="social-icon-circle bg-twitter">
                                    <i class="bi bi-twitter-x"></i>
                                </a>
                                <a href="#" class="social-icon-circle bg-linkedin">
                                    <i class="bi bi-linkedin"></i>
                                </a>
                                <a href="#" class="social-icon-circle bg-instagram">
                                    <i class="bi bi-instagram"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-7">
                    <div class="contact-form-card animate-on-scroll" data-animation="fadeInUp">
                        <h3 class="mb-4">Send Us a Message</h3>
                        <form>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label for="name" class="form-label">Your Name</label>
                                    <input type="text" class="form-control" id="name" placeholder="Enter your name" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="email" class="form-label">Email Address</label>
                                    <input type="email" class="form-control" id="email" placeholder="Enter your email" required>
                                </div>
                                <div class="col-12">
                                    <label for="subject" class="form-label">Subject</label>
                                    <input type="text" class="form-control" id="subject" placeholder="What's this about?" required>
                                </div>
                                <div class="col-12">
                                    <label for="message" class="form-label">Message</label>
                                    <textarea class="form-control" id="message" rows="5" placeholder="How can we help you?" required></textarea>
                                </div>
                                <div class="col-12">
                                    <button type="submit" class="btn btn-primary btn-lg w-100 btn-hover-effect">Send Message</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Map Section -->
    <section class="map-section">
        <div class="container-fluid p-0">
            <div class="ratio ratio-21x9">
                <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3799.615316178283!2d31.03385631544251!3d-17.82534488784848!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x1931a567a3aa6567%3A0x5f1a4bca1a8dd6b2!2sStanley%20House%2C%20Harare!5e0!3m2!1sen!2szw!4v1620000000000!5m2!1sen!2szw" allowfullscreen="" loading="lazy"></iframe>
            </div>
        </div>
    </section>
  </div>

  <!--this is the homeConten page-->
  <div id="homeContent" class="container-fluid py-4">
      <!-- Modern Bundle Deals Section -->
      <!-- Modern Category Deals -->
      <section class="py-5 bg-light" style="margin-top: -50px;">
          <div class="container">
              <div class="section-header mb-5 text-center">
                  <h2 class="section-title display-5 fw-bold mb-3">
                      SHOP BY <span class="text-gradient-primary">CATEGORY</span>
                      <span class="badge bg-danger ms-2 fs-6">UP TO 80% OFF</span>
                  </h2>
                  <p class="section-subtitle text-muted fs-5">Massive discounts across all departments</p>
              </div>
              
              <div class="row g-4">
                  <div class="col-md-6 col-lg-3">
                      <div class="category-card modern-category bg-white rounded-4 overflow-hidden shadow-sm h-100 transition-all hover-shadow-lg">
                          <div class="category-image position-relative">
                              <img src="https://placehold.co/600x400/0d6efd/white?text=Smartphones" alt="Smartphones" class="img-fluid w-100">
                              <div class="category-badge bg-danger text-white position-absolute top-0 end-0 m-3 px-2 py-1 rounded-1">
                                  UP TO 60% OFF
                              </div>
                          </div>
                          <div class="category-content p-4">
                              <h3 class="category-title fw-bold mb-3">SMARTPHONES</h3>
                              <p class="category-desc small text-muted mb-4">Latest models from Apple, Samsung & more with exclusive deals</p>
                              <a href="#" data-filter="Smartphones" class="btn btn-outline-danger d-flex align-items-center justify-content-between ajax-category">
                                  SHOP NOW
                                  <i class="bi bi-arrow-right ms-2"></i>
                              </a>
                          </div>
                      </div>
                  </div>
                  
                  <div class="col-md-6 col-lg-3">
                      <div class="category-card modern-category bg-white rounded-4 overflow-hidden shadow-sm h-100 transition-all hover-shadow-lg">
                          <div class="category-image position-relative">
                              <img src="https://placehold.co/600x400/198754/white?text=Laptops" alt="Laptops" class="img-fluid w-100">
                              <div class="category-badge bg-primary text-white position-absolute top-0 end-0 m-3 px-2 py-1 rounded-1">
                                  UP TO 55% OFF
                              </div>
                          </div>
                          <div class="category-content p-4">
                              <h3 class="category-title fw-bold mb-3">LAPTOPS</h3>
                              <p class="category-desc small text-muted mb-4">Powerful machines for work & play with student discounts</p>
                              <a href="#" data-filter="Laptops" class="btn btn-outline-primary d-flex align-items-center justify-content-between ajax-category">
                                  SHOP NOW
                                  <i class="bi bi-arrow-right ms-2"></i>
                              </a>
                          </div>
                      </div>
                  </div>
                  
                  <div class="col-md-6 col-lg-3">
                      <div class="category-card modern-category bg-white rounded-4 overflow-hidden shadow-sm h-100 transition-all hover-shadow-lg">
                          <div class="category-image position-relative">
                              <img src="https://placehold.co/600x400/6610f2/white?text=Gaming" alt="Gaming" class="img-fluid w-100">
                              <div class="category-badge bg-warning text-dark position-absolute top-0 end-0 m-3 px-2 py-1 rounded-1">
                                  UP TO 70% OFF
                              </div>
                          </div>
                          <div class="category-content p-4">
                              <h3 class="category-title fw-bold mb-3">GAMING</h3>
                              <p class="category-desc small text-muted mb-4">Consoles, games & accessories with exclusive bundles</p>
                              <a href="#" data-filter="Gaming" class="btn btn-outline-warning d-flex align-items-center justify-content-between ajax-category">
                                  SHOP NOW
                                  <i class="bi bi-arrow-right ms-2"></i>
                              </a>
                          </div>
                      </div>
                  </div>
                  
                  <div class="col-md-6 col-lg-3">
                      <div class="category-card modern-category bg-white rounded-4 overflow-hidden shadow-sm h-100 transition-all hover-shadow-lg">
                          <div class="category-image position-relative">
                              <img src="https://placehold.co/600x400/fc1e1e/white?text=Accessories" alt="Accessories" class="img-fluid w-100">
                              <div class="category-badge bg-success text-white position-absolute top-0 end-0 m-3 px-2 py-1 rounded-1">
                                  UP TO 80% OFF
                              </div>
                          </div>
                          <div class="category-content p-4">
                              <h3 class="category-title fw-bold mb-3">ACCESSORIES</h3>
                              <p class="category-desc small text-muted mb-4">Cases, chargers & more with buy 2 get 1 free</p>
                              <a href="#" data-filter="Accessories" class="btn btn-outline-success d-flex align-items-center justify-content-between ajax-category">
                                  SHOP NOW
                                  <i class="bi bi-arrow-right ms-2"></i>
                              </a>
                          </div>
                      </div>
                  </div>
              </div>
          </div>
      </section>
  
      <section id="bundles">
        <div class="container">
          {% if bundles %}
          <div class="row gx-1 gy-2">
            {% for bundle in bundles %}
            <div class="col-6 d-flex">
              <!-- Equal height card -->
              <div class="bundle-card shadow-sm w-100">
                <!-- Floating badge -->
                <div class="position-absolute top-0 start-0 m-3">
                  <span class="badge bg-gradient-info px-3 py-2 rounded-pill shadow-sm" style="color: black;">
                    {{ bundle.badge }}
                  </span>
                </div>

                <div class="row g-0 flex-grow-1">
                  <!-- Left side - Images -->
                  <div class="col-5 p-4 d-flex flex-column align-items-center justify-content-center bg-white">
                    {# Vertical stacked images: top product image, plus sign, bottom product or bundle extra image #}
                    <div class="d-flex flex-column align-items-center" style="gap:18px;">
                      {% with products=bundle.products.all %}
                        {% if products and products|length >= 1 %}
                          {% with p=products.0 %}
                            <a href="{% url 'product_detail' p.id %}" class="text-decoration-none d-flex align-items-center justify-content-center">
                              {% if p.image %}
                                <img src="{{ p.image.url }}" alt="{{ p.name }}" style="width:120px; height:120px; object-fit:cover; border-radius:8px;" />
                              {% else %}
                                <img src="{% static 'website/images/default-image.svg' %}" alt="No Image" style="width:120px; height:120px; object-fit:cover; border-radius:8px;" />
                              {% endif %}
                            </a>
                          {% endwith %}

                          <div class="text-muted d-flex align-items-center justify-content-center" aria-hidden="true">
                            <i class="bi bi-plus-lg" style="font-size:22px; color:#6b7280;"></i>
                          </div>

                          {% if products|length >= 2 %}
                            {% with p=products.1 %}
                              <a href="{% url 'product_detail' p.id %}" class="text-decoration-none d-flex align-items-center justify-content-center">
                                {% if p.image %}
                                  <img src="{{ p.image.url }}" alt="{{ p.name }}" style="width:120px; height:120px; object-fit:cover; border-radius:8px;" />
                                {% else %}
                                  <img src="{% static 'website/images/default-image.svg' %}" alt="No Image" style="width:120px; height:120px; object-fit:cover; border-radius:8px;" />
                                {% endif %}
                              </a>
                            {% endwith %}
                          {% else %}
                            {# fallback to bundle.image_2 if second product not present #}
                            {% if bundle.image_2 %}
                              <img src="{{ bundle.image_2.url }}" alt="{{ bundle.title }} extra" style="width:120px; height:120px; object-fit:cover; border-radius:8px;" class="img-fluid rounded-3 shadow-sm" />
                            {% else %}
                              <img src="https://placehold.co/200x200/198754/white?text=Extra" alt="No image" style="width:120px; height:120px; object-fit:cover; border-radius:8px;" class="img-fluid rounded-3 shadow-sm" />
                            {% endif %}
                          {% endif %}

                        {% else %}
                          {# No bundle.products - show single extra image or placeholder #}
                          {% if bundle.image_2 %}
                            <img src="{{ bundle.image_2.url }}" alt="{{ bundle.title }} extra" style="width:160px; height:160px; object-fit:cover; border-radius:8px;" class="img-fluid rounded-3 shadow-sm" />
                          {% else %}
                            <img src="https://placehold.co/200x200/198754/white?text=No+Image" alt="No image" style="width:160px; height:160px; object-fit:cover; border-radius:8px;" class="img-fluid rounded-3 shadow-sm" />
                          {% endif %}
                        {% endif %}
                      {% endwith %}
                    </div>
                  </div>

                  <!-- Right side - Details -->
                  <div class="col-7 d-flex flex-column">
                    <div class="p-4 d-flex flex-column flex-grow-1">
                      <h4 class="mb-2 fw-bold text-dark" style="font-size: 30px;">{{ bundle.title }}</h4>
                      <p class="text-muted small mb-3">{{ bundle.description }}</p>
                      
                      <!-- Pricing -->
                      <div class="mb-3">
                        <div class="h5 mb-0 text-primary fw-bold" style="font-size: 60px;">${{ bundle.price }}</div>
                        <div class="small text-muted">for bundle</div>
                        <div class="mt-4">
                          <li>
                            {% if bundle.image_desc_1 %}
                              <div class="small text-muted mt-2">{{ bundle.image_desc_1 }}</div>
                            {% endif %}
                          </li>
                          <li>
                            {% if bundle.image_desc_2 %}
                              <div class="small text-muted mt-2">{{ bundle.image_desc_2 }}</div>
                            {% endif %}
                          </li>
                        </div>
                      </div>

                      <!-- Actions -->
                      <div class="mt-auto d-flex gap-2">
                        <button type="button" class="btn btn-primary btn-lg flex-grow-1 shadow-sm">
                          <i class="bi bi-cart-plus me-2"></i> ADD TO CART
                        </button>
                        <a href="/api/bundles/{{ bundle.id }}/" class="btn btn-outline-dark btn-lg">
                          VIEW
                        </a>
                      </div>

                      <!-- Shipping Info -->
                      <div class="d-flex align-items-center mt-3 text-muted small">
                        <i class="bi bi-truck me-2 text-success"></i>
                        <span>Free shipping & easy returns</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
          {% else %}
            <p class="text-center text-muted">No bundles available at the moment. Please check back later.</p>
          {% endif %}
        </div>
      </section>
  </div>

  <!-- this is the account page  -->
  <div id="accounts_page" style="display: none;">
    <div class="dashboard-container">
        <!-- Header Section -->
        <!-- Main Content -->
        <div class="content-grid">
            <!-- Primary Content -->
            <main>
                <!-- Cards Section -->
                <div class="cards-section">
                    <!-- Orders Card -->
                    <div class="feature-card neon-card">
                        <div class="feature-header">
                            <div class="feature-icon blue">
                                <i class="bi bi-box-seam"></i>
                            </div>
                            <div>
                                <h3 class="feature-title">Your Orders</h3>
                                <div class="badge bg-primary bg-opacity-10 text-primary">3 Active</div>
                            </div>
                        </div>
                        <p class="feature-description">Track, return, or buy again from your order history</p>
                        <div class="feature-actions">
                            <a href="#" class="action-btn">
                                <span>View Order History</span>
                                <i class="bi bi-chevron-right"></i>
                            </a>
                            <a href="#" class="action-btn">
                                <span>Buy Again</span>
                                <i class="bi bi-chevron-right"></i>
                            </a>
                        </div>
                    </div>
                    
                    <!-- Security Card -->
                    <div class="feature-card neon-card">
                        <div class="feature-header">
                            <div class="feature-icon green">
                                <i class="bi bi-shield-lock"></i>
                            </div>
                            <div>
                                <h3 class="feature-title">Security Center</h3>
                                <div class="badge bg-success bg-opacity-10 text-success">85% Secure</div>
                            </div>
                        </div>
                        <p class="feature-description">Your account security is strong. Enable additional protections.</p>
                        <div class="feature-actions">
                            <a href="#" class="action-btn">
                                <span>Password Manager</span>
                                <i class="bi bi-chevron-right"></i>
                            </a>
                            <a href="#" class="action-btn">
                                <span>Two-Factor Auth</span>
                                <i class="bi bi-chevron-right"></i>
                            </a>
                        </div>
                    </div>
                    
                    <!-- Payments Card -->
                    <div class="feature-card neon-card">
                        <div class="feature-header">
                            <div class="feature-icon purple">
                                <i class="bi bi-credit-card"></i>
                            </div>
                            <div>
                                <h3 class="feature-title">Payment Methods</h3>
                                <div class="badge bg-purple bg-opacity-10 text-purple">2 Saved</div>
                            </div>
                        </div>
                        <p class="feature-description">Manage your saved payment options and billing</p>
                        <div class="feature-actions">
                            <a href="#" class="action-btn">
                                <span>Payment Options</span>
                                <i class="bi bi-chevron-right"></i>
                            </a>
                            <a href="#" class="action-btn">
                                <span>Billing History</span>
                                <i class="bi bi-chevron-right"></i>
                            </a>
                        </div>
                    </div>
                    
                    <!-- Premium Card -->
                    <div class="feature-card neon-card premium">
                        <div class="premium-badge">
                            <i class="bi bi-star-fill"></i>
                            <span>Premium</span>
                        </div>
                        <div class="feature-header">
                            <div class="feature-icon orange">
                                <i class="bi bi-gem"></i>
                            </div>
                            <div>
                                <h3 class="feature-title">Exclusive Benefits</h3>
                                <div class="badge bg-warning bg-opacity-10 text-warning">Gold Tier</div>
                            </div>
                        </div>
                        <p class="feature-description">Unlock premium features with your membership</p>
                        <div class="feature-actions">
                            <a href="#" class="action-btn">
                                <span>View Benefits</span>
                                <i class="bi bi-chevron-right"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </main>
            
            <!-- Sidebar -->
            <aside class="sidebar">
                <!-- Activity Feed -->
                <div class="activity-feed">
                    <h3 class="section-title">
                        <i class="bi bi-activity"></i>
                        <span>Recent Activity</span>
                    </h3>
                    <div class="activity-items">
                        <div class="activity-item">
                            <div class="activity-icon blue">
                                <i class="bi bi-box-seam"></i>
                            </div>
                            <div class="activity-content">
                                <p class="activity-text">Order #42568 has been shipped</p>
                                <span class="activity-time">2 hours ago</span>
                            </div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-icon green">
                                <i class="bi bi-credit-card"></i>
                            </div>
                            <div class="activity-content">
                                <p class="activity-text">Payment method updated</p>
                                <span class="activity-time">Yesterday</span>
                            </div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-icon purple">
                                <i class="bi bi-geo-alt"></i>
                            </div>
                            <div class="activity-content">
                                <p class="activity-text">New shipping address added</p>
                                <span class="activity-time">2 days ago</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Links -->
                <div class="quick-links">
                    <h3 class="section-title">
                        <i class="bi bi-lightning"></i>
                        <span>Quick Actions</span>
                    </h3>
                    <div class="link-grid">
                        <a href="#" class="link-item">
                            <div class="link-icon blue">
                                <i class="bi bi-plus-lg"></i>
                            </div>
                            <span class="link-text">New Order</span>
                        </a>
                        <a href="#" class="link-item">
                            <div class="link-icon green">
                                <i class="bi bi-geo-alt"></i>
                            </div>
                            <span class="link-text">Add Address</span>
                        </a>
                        <a href="#" class="link-item">
                            <div class="link-icon orange">
                                <i class="bi bi-gift"></i>
                            </div>
                            <span class="link-text">Rewards</span>
                        </a>
                        <a href="#" class="link-item">
                            <div class="link-icon purple">
                                <i class="bi bi-headset"></i>
                            </div>
                            <span class="link-text">Support</span>
                        </a>
                    </div>
                </div>
            </aside>
        </div>
    </div>
  </div>
  
  <div id="testimonial_page" style="display: none;">
    <div class="testimonials-container mt-3">
        <h2 class="section-title text-center mb-5" style="font-size: 2rem;">More Success Stories</h2>
        
        <div class="testimonial-grid">
            <!-- Testimonial 1 -->
            <div class="testimonial-card neon-card">
                <div class="testimonial-content">
                    <p class="testimonial-text">The customer segmentation tools helped us personalize our outreach like never before. Our conversion rates improved by 35% in just three months.</p>
                    <div class="testimonial-author">
                        <img src="https://images.unsplash.com/photo-1531123897727-8f129e1688ce?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=300&q=80" alt="Nia Thompson" class="author-avatar">
                        <div class="author-info">
                            <h4 class="author-name">Nia Thompson</h4>
                            <p class="author-title">Sales Manager, Elevate Corp</p>
                            <div class="author-rating">
                                <i class="bi bi-star-fill rating-star"></i>
                                <i class="bi bi-star-fill rating-star"></i>
                                <i class="bi bi-star-fill rating-star"></i>
                                <i class="bi bi-star-fill rating-star"></i>
                                <i class="bi bi-star-fill rating-star"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Testimonial 2 -->
            <div class="testimonial-card neon-card">
                <div class="testimonial-content">
                    <p class="testimonial-text">Implementation was seamless with their onboarding team. We were up and running in days, not weeks. The ROI was immediate and substantial.</p>
                    <div class="testimonial-author">
                        <img src="https://images.unsplash.com/photo-1522529599102-193c0d76b5b6?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=300&q=80" alt="Malik Johnson" class="author-avatar">
                        <div class="author-info">
                            <h4 class="author-name">Malik Johnson</h4>
                            <p class="author-title">CTO, NexGen Analytics</p>
                            <div class="author-rating">
                                <i class="bi bi-star-fill rating-star"></i>
                                <i class="bi bi-star-fill rating-star"></i>
                                <i class="bi bi-star-fill rating-star"></i>
                                <i class="bi bi-star-fill rating-star"></i>
                                <i class="bi bi-star-half rating-star"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Testimonial 3 -->
            <div class="testimonial-card neon-card">
                <div class="testimonial-content">
                    <p class="testimonial-text">As an educator transitioning to edtech, I needed tools that were accessible. This platform made complex data simple to understand and act upon.</p>
                    <div class="testimonial-author">
                        <img src="https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=300&q=80" alt="Dr. Keisha Brown" class="author-avatar">
                        <div class="author-info">
                            <h4 class="author-name">Dr. Keisha Brown</h4>
                            <p class="author-title">Director, LearnBright Academy</p>
                            <div class="author-rating">
                                <i class="bi bi-star-fill rating-star"></i>
                                <i class="bi bi-star-fill rating-star"></i>
                                <i class="bi bi-star-fill rating-star"></i>
                                <i class="bi bi-star-fill rating-star"></i>
                                <i class="bi bi-star-fill rating-star"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
  </div>

  <!-- this is the product details page  -->
  <div id="product_details_page" style="display: none; padding-top:20px; padding-bottom:20px;">
    <div class="DesktopView">
      <div class="row gy-4 align-items-start" style="margin-left:250px !important;">
        <!-- Left: small stacked thumbnails -->
        <div class="col-lg-2 d-none d-lg-block" style="position:relative; margin-top: 100px; z-index:12; margin-right:0 !important; padding-right:0 !important;">
          <div class="product-thumbs d-flex flex-column" style="max-width:200px; padding-right:0; gap:10px;">
            <!-- thumbnails populated by JS -->
          </div>
        </div>

        <!-- Middle: large main image -->
        <div class="col-12 col-lg-6 text-center" style="padding-left:4px !important;">
          <div class="product-image-main" style="min-height:600px; display:flex; align-items:center; justify-content:center; padding-left:4px !important;">
            <img id="mainProductImage" src="{% static 'website/images/default-image.svg' %}" alt="Product image" class="img-fluid rounded shadow-sm" style="max-height:80vh; max-width:100%; width:100%; height:auto; object-fit:contain;">
          </div>
        </div>

        <!-- Right: product details -->
        <div class="col-12 col-lg-4" style="padding-left:20px !important; max-width:400px;">
          <div class="mb-3 d-flex gap-2">
            <a href="" class="btn btn-outline-secondary">
              <i class="bi bi-arrow-left-circle me-1"></i> Products
            </a>
            <!-- Inline Buy Now: submit the same fields as product cards to addProduct_to_cart -->
            <form method="POST" action="{% url 'addProduct_to_cart' %}" class="d-inline-block m-0 p-0" id="inlineBuyForm">
              {% csrf_token %}
              <!-- Ensure hidden inputs always exist; JS will populate values when product loads -->
              <input type="hidden" name="product_id" id="inline_product_id" value="{{ product.id|default:'' }}">
              <input type="hidden" name="name" id="inline_name" value="{{ product.name|default:'' }}">
              <input type="hidden" name="price" id="inline_price" value="{{ product.price|default:'' }}">
              <input type="hidden" name="condition" id="inline_condition" value="{{ product.condition|default:'' }}">
              <input type="hidden" name="category" id="inline_category" value="{{ product.category|default:'' }}">
              <input type="hidden" name="image_url" id="inline_image_url" value="{% if product.image %}{{ product.image.name }}{% else %}{% static 'website/images/default-image.svg' %}{% endif %}">
              <button type="submit" id="buyNowBtnInlineBtn" class="btn btn-primary" style="background-color:#9150EC; color: #fff;">
                <i class="bi bi-cart-fill me-1"></i> Buy Now
              </button>
            </form>
          </div>

          <h2 class="product-title mb-2">{{ product.name }}</h2>
          <div class="product-price mb-3">${{ product.price }}</div>

          <!-- Product Details -->
          <div class="details-container p-3">
            {% if product.category|is_meaningful %}
              <div class="detail-item"><span class="label">Category</span><span class="value">{{ product.category }}</span></div>
            {% endif %}

            {% if product.condition|is_meaningful %}
              <div class="detail-item"><span class="label">Condition</span><span class="value">{{ product.condition }}</span></div>
            {% endif %}

            {% if product.brand_model|is_meaningful %}
              <div class="detail-item"><span class="label">Model</span><span class="value">{{ product.brand_model }}</span></div>
            {% elif product.brand|is_meaningful %}
              <div class="detail-item"><span class="label">Brand</span><span class="value">{{ product.brand }}</span></div>
            {% endif %}

            {% if product.stock|is_meaningful %}
              <div class="detail-item"><span class="label">Stock</span>
                <span class="value">
                  {% if product.stock|to_int == 0 %}
                    <span class="text-danger fw-bold">Out of stock</span>
                  {% else %}
                    {{ product.stock }} available
                  {% endif %}
                </span>
              </div>
            {% endif %}

            {% if product.location|is_meaningful %}
              <div class="detail-item"><span class="label">Delivery</span>
                <span class="value">{% if product.location == 'local' %}Tomorrow{% elif product.location == 'exotic' %}2 Weeks{% else %}Standard{% endif %}</span>
              </div>
            {% endif %}

            {% if product.color|is_meaningful %}
              <div class="detail-item"><span class="label">Color</span><span class="value">{{ product.color }}</span></div>
            {% endif %}

            {% if product.storage_ram|is_meaningful %}
              <div class="detail-item"><span class="label">Storage / RAM</span><span class="value">{{ product.storage_ram }}</span></div>
            {% endif %}

            {% if product.network|is_meaningful %}
              <div class="detail-item"><span class="label">Network</span><span class="value">{{ product.network }}</span></div>
            {% endif %}

            {% if product.battery|is_meaningful %}
              <div class="detail-item"><span class="label">Battery</span><span class="value">{{ product.battery }}</span></div>
            {% endif %}

            {% if product.camera|is_meaningful %}
              <div class="detail-item"><span class="label">Camera</span><span class="value">{{ product.camera }}</span></div>
            {% endif %}

            {% if product.screen|is_meaningful %}
              <div class="detail-item"><span class="label">Screen</span><span class="value">{{ product.screen }}</span></div>
            {% endif %}

            {% if product.processor|is_meaningful %}
              <div class="detail-item"><span class="label">Processor</span><span class="value">{{ product.processor }}</span></div>
            {% endif %}

            {% if product.os|is_meaningful %}
              <div class="detail-item"><span class="label">OS</span><span class="value">{{ product.os }}</span></div>
            {% endif %}

            {% if product.accessories|is_meaningful %}
              <div class="detail-item"><span class="label">Accessories</span><span class="value">{{ product.accessories }}</span></div>
            {% endif %}

            {% if product.warranty|is_meaningful %}
              <div class="detail-item"><span class="label">Warranty</span><span class="value">{{ product.warranty }}</span></div>
            {% endif %}

            {% if product.optional_details|is_meaningful %}
              <div class="detail-item"><span class="label">Additional Details</span><span class="value">{{ product.optional_details }}</span></div>
            {% endif %}

            {% if product.available is not none %}
              <div class="detail-item"><span class="label">Available</span>
                <span class="value">{% if product.available %}Yes{% else %}No{% endif %}</span>
              </div>
            {% endif %}
          </div>

          <style>
            .details-container {
              background: #fff;
              border: 1px solid #eee;
              display: grid;
              grid-template-columns: 150px 1fr; /* fixed labels, flexible values */
              gap: 8px 16px;
              font-size: 15px;
            }

            .detail-item {
              display: contents; /* keeps grid layout neat */
            }

            .detail-item .label {
              font-weight: 600;
              color: #444;
            }

            .detail-item .value {
              color: #222;
            }

            .description-box h5 {
              font-size: 16px;
              color: #333;
            }

            .description-box p {
              font-size: 14px;
              line-height: 1.5;
            }

          </style>
        </div>
      </div>

      <!-- Related products (same category) -->
      <div class="row mt-5">
        <div class="col-12 text-center">
          <h4 class="fw-bold mb-4" style="color:#333;">✨ Related Products</h4>
        </div>

        <div class="col-12">
          <div class="row g-4 related-products-grid">
            {% for related in related_products %}
              <div class="col-6 col-md-3">
                <div class="card h-100 border-0 shadow-sm rounded-3 overflow-hidden product-card">
                  <a href="{% url 'product_detail' related.id %}" class="text-decoration-none d-block text-center p-3">
                    {% if related.image %}
                      <img src="{{ related.image.url }}" 
                          class="img-fluid mx-auto d-block product-image" 
                          alt="{{ related.name }}">
                    {% else %}
                      <img src="{% static 'website/images/default-image.svg' %}" 
                          class="img-fluid mx-auto d-block product-image" 
                          alt="No Image">
                    {% endif %}

                    <div class="card-body text-center mt-2 p-0">
                      <h6 class="card-title text-dark fw-semibold mb-1">{{ related.name }}</h6>
                      <p class="card-text fw-bold mb-0" style="color:#9150EC;">${{ related.price }}</p>
                    </div>
                  </a>
                </div>
              </div>
            {% empty %}
              <div class="col-12 text-center text-muted">No related products found.</div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>

    <div class="MobileViewPg">
      <!-- Mobile Product Detail Page -->
      <div class="MobileView d-lg-none px-3 py-4">
        <!-- Back + Buy Buttons -->
        <div class="mb-3 mobile-action-row d-flex gap-2 align-items-center">
          <a href="javascript:void(0);" onclick="(function(){ try{ if(window.openSection){ window.openSection('promotion_page'); return; } }catch(e){} window.location.href='?page=1'; })()" class="mobile-action-btn btn-mobile-products text-center d-flex align-items-center justify-content-center">
            <i class="bi bi-box-seam me-2"></i>
            <span>Products</span>
          </a>
          <form method="POST" action="{% url 'addProduct_to_cart' %}" id="inlineBuyFormMobile" class="d-inline-block m-0 p-0" style="flex:1;">
            {% csrf_token %}
            <input type="hidden" name="product_id" id="inline_product_id_mobile" value="{{ product.id|default:'' }}">
            <input type="hidden" name="name" id="inline_name_mobile" value="{{ product.name|default:'' }}">
            <input type="hidden" name="price" id="inline_price_mobile" value="{{ product.price|default:'' }}">
            <input type="hidden" name="condition" id="inline_condition_mobile" value="{{ product.condition|default:'' }}">
            <input type="hidden" name="category" id="inline_category_mobile" value="{{ product.category|default:'' }}">
            <input type="hidden" name="image_url" id="inline_image_url_mobile" value="{% if product.image %}{{ product.image.name }}{% else %}{% static 'website/images/default-image.svg' %}{% endif %}">
            <button type="submit" id="buyNowBtnInlineMobile" class="mobile-action-btn btn-mobile-buy d-flex align-items-center justify-content-center" style="width:100%;">
              <i class="bi bi-cart-fill me-2"></i>
              <span>Buy Now</span>
            </button>
          </form>
        </div>

        <!-- Main Product Image -->
        <div class="text-center mb-3">
          <img id="mainProductImageMobile" 
              src="{% static 'website/images/default-image.svg' %}" 
              alt="Product image"
              class="img-fluid rounded shadow-sm"
              style="max-height:60vh; width:100%; object-fit:contain;">
        </div>

        <!-- Thumbnails -->
        <div class="d-flex justify-content-center gap-2 mb-3 flex-wrap product-thumbs-mobile">
          <!-- populated by JS -->
        </div>

        <!-- Product Title + Price -->
        <h4 class="fw-semibold mb-1 text-center">{{ product.name }}</h4>
        <div class="product-price text-center mb-3 fw-bold" style="color:#9150EC;">
          ${{ product.price }}
        </div>

        <!-- Product Details -->
        <div class="details-container-mobile p-3 rounded shadow-sm bg-white mb-4">
          {% if product.category|is_meaningful %}
            <div class="detail-item"><span class="label">Category</span><span class="value">{{ product.category }}</span></div>
          {% endif %}
          {% if product.condition|is_meaningful %}
            <div class="detail-item"><span class="label">Condition</span><span class="value">{{ product.condition }}</span></div>
          {% endif %}
          {% if product.brand_model|is_meaningful %}
            <div class="detail-item"><span class="label">Model</span><span class="value">{{ product.brand_model }}</span></div>
          {% elif product.brand|is_meaningful %}
            <div class="detail-item"><span class="label">Brand</span><span class="value">{{ product.brand }}</span></div>
          {% endif %}
          {% if product.stock|is_meaningful %}
            <div class="detail-item"><span class="label">Stock</span>
              <span class="value">
                {% if product.stock|to_int == 0 %}
                  <span class="text-danger fw-bold">Out of stock</span>
                {% else %}
                  {{ product.stock }} available
                {% endif %}
              </span>
            </div>
          {% endif %}
          {% if product.color|is_meaningful %}
            <div class="detail-item"><span class="label">Color</span><span class="value">{{ product.color }}</span></div>
          {% endif %}
          {% if product.storage_ram|is_meaningful %}
            <div class="detail-item"><span class="label">Storage / RAM</span><span class="value">{{ product.storage_ram }}</span></div>
          {% endif %}
          {% if product.processor|is_meaningful %}
            <div class="detail-item"><span class="label">Processor</span><span class="value">{{ product.processor }}</span></div>
          {% endif %}
          {% if product.battery|is_meaningful %}
            <div class="detail-item"><span class="label">Battery</span><span class="value">{{ product.battery }}</span></div>
          {% endif %}
          {% if product.camera|is_meaningful %}
            <div class="detail-item"><span class="label">Camera</span><span class="value">{{ product.camera }}</span></div>
          {% endif %}
          {% if product.screen|is_meaningful %}
            <div class="detail-item"><span class="label">Screen</span><span class="value">{{ product.screen }}</span></div>
          {% endif %}
          {% if product.network|is_meaningful %}
            <div class="detail-item"><span class="label">Network</span><span class="value">{{ product.network }}</span></div>
          {% endif %}
          {% if product.accessories|is_meaningful %}
            <div class="detail-item"><span class="label">Accessories</span><span class="value">{{ product.accessories }}</span></div>
          {% endif %}
          {% if product.optional_details|is_meaningful %}
            <div class="detail-item"><span class="label">Details</span><span class="value">{{ product.optional_details }}</span></div>
          {% endif %}
          {% if product.available is not none %}
            <div class="detail-item"><span class="label">Available</span><span class="value">{% if product.available %}Yes{% else %}No{% endif %}</span></div>
          {% endif %}
          {% if product.sku %}
            <div class="detail-item"><span class="label">SKU</span><span class="value">{{ product.sku }}</span></div>
          {% endif %}
          {% if product.warranty|is_meaningful %}
            <div class="detail-item"><span class="label">Warranty</span><span class="value">{{ product.warranty }}</span></div>
          {% endif %}
        </div>

        <!-- Related Products -->
        <div class="related-products-mobile">
          <h5 class="fw-bold text-center mb-3">✨ Related Products</h5>
          <div class="row g-3">
            {% for related in related_products %}
              <div class="col-6">
                <div class="card border-0 shadow-sm text-center">
                  <a href="{% url 'product_detail' related.id %}" class="text-decoration-none">
                    {% if related.image %}
                      <img src="{{ related.image.url }}" class="img-fluid rounded-top" alt="{{ related.name }}">
                    {% else %}
                      <img src="{% static 'website/images/default-image.svg' %}" class="img-fluid rounded-top" alt="No Image">
                    {% endif %}
                    <div class="p-2">
                      <div class="fw-semibold small">{{ related.name }}</div>
                      <div class="fw-bold text-primary">${{ related.price }}</div>
                    </div>
                  </a>
                </div>
              </div>
            {% empty %}
              <div class="col-12 text-center text-muted">No related products found.</div>
            {% endfor %}
          </div>
        </div>
      </div>

      <style>
        .details-container-mobile {
          display: flex;
          flex-direction: column;
          gap: 8px;
          font-size: 14px;
        }

        .detail-item {
          display: flex;
          justify-content: space-between;
          border-bottom: 1px solid #eee;
          padding-bottom: 4px;
        }

        .detail-item .label {
          font-weight: 600;
          color: #555;
        }

        .detail-item .value {
          color: #222;
          text-align: right;
        }
      </style>
      <style>
        /* Mobile action buttons: modern, equal width, same height */
        .mobile-action-row { width: 100%; }
        .mobile-action-row .mobile-action-btn { flex: 1; min-height: 48px; padding: 10px 12px; border-radius: 12px; font-weight: 600; font-size: 15px; }
        .mobile-action-row .mobile-action-btn i { font-size: 1.05rem; }

        /* Products button: subtle light background */
        .btn-mobile-products { background: #ffffff; border: 1px solid #e6e6f0; color: #222; box-shadow: 0 6px 18px rgba(14,13,38,0.05); }
        .btn-mobile-products:hover { transform: translateY(-1px); box-shadow: 0 10px 30px rgba(14,13,38,0.08); }

        /* Buy button: gradient accent */
        .btn-mobile-buy { background: linear-gradient(90deg, #9150EC 0%, #5B2DD1 100%); color: #fff; border: none; box-shadow: 0 8px 28px rgba(145,80,236,0.18); }
        .btn-mobile-buy:active, .btn-mobile-buy:focus, .btn-mobile-buy:hover { transform: translateY(-1px); box-shadow: 0 12px 36px rgba(91,45,209,0.18); }

        /* Ensure text doesn't wrap weirdly and icons align */
        .mobile-action-btn span { white-space: nowrap; display: inline-block; }

        /* Make sure row stacks on very narrow screens while keeping equal widths when side-by-side */
        @media (max-width: 360px) {
          .mobile-action-row { flex-direction: column; }
          .mobile-action-row .mobile-action-btn { width: 100%; }
        }
      </style>

    <style>
      /* Responsive toggles: MobileViewPg visible only on small screens, DesktopView only on large screens */
      .MobileViewPg { display: none; }
      .DesktopView { display: block; }

      @media (max-width: 991px) {
        .MobileViewPg { display: block; }
        .DesktopView { display: none; }
      }
    </style>

    </div>

    <style>
      .product-card {
        transition: transform 0.25s ease, box-shadow 0.25s ease;
        background: #fff;
      }
      .product-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0,0,0,0.08);
      }
      .product-image {
        max-height: 140px;
        object-fit: contain;
        transition: transform 0.3s ease;
      }
      .product-card:hover .product-image {
        transform: scale(1.05);
      }
    </style>
  </div>

  <!-- Footer: Quick Links | Contact Us | Opening Hours -->
  <footer class="footer bg-white border-top py-5">
    <div class="container">
      <div class="row text-start gy-4">
        <!-- Quick Links (hidden on small screens) -->
        <div class="col-md-4 QuickLinks d-none d-md-block">
          <h5 class="fw-semibold mb-3">Quick Links</h5>
          <ul class="list-unstyled footer-links">
            <li class="mb-2"><a href="{% url 'home' %}" class="text-dark text-decoration-none">Home</a></li>
            <li class="mb-2"><a href="#about_us_page" class="text-dark text-decoration-none">About Us</a></li>
            <li class="mb-2"><a href="{% url 'product_list' %}" class="text-dark text-decoration-none">Products</a></li>
            <li class="mb-2"><a href="#services" class="text-dark text-decoration-none">Our Services</a></li>
            <li class="mb-2"><a href="#contact" class="text-dark text-decoration-none">Contact Us</a></li>
          </ul>
        </div>

        <!-- Contact Us (center) -->
        <div class="col-md-4 text-center">
          <h5 class="fw-semibold mb-3">Contact Us</h5>
          <div class="mb-2">
            <a href="tel:+263713123084" class="text-dark fw-bold fs-5 text-decoration-none">+263 713123084</a>
            <div class="text-muted small">Call us for more</div>
          </div>
          <div class="mb-2">
            <a href="mailto:sales@liontech.co.zw" class="text-dark text-decoration-none">sales@liontech.co.zw</a>
            <div class="text-muted small">Get in touch with us</div>
          </div>
          <div class="mt-2">
            <a href="https://www.google.com/maps/search/NETONE+Building,+Harare,+Zimbabwe" target="_blank" class="text-dark text-decoration-none fw-semibold">NETONE Building, Harare, Zimbabwe</a>
            <div class="text-muted small">Harare</div>
          </div>
        </div>

        <!-- Opening Hours -->
        <div class="col-md-4">
          <h5 class="fw-semibold mb-3">Opening Hours</h5>
          <ul class="list-unstyled text-dark small">
            <li class="d-flex justify-content-between"><span>Monday</span><span>8:30am - 4:00pm</span></li>
            <li class="d-flex justify-content-between"><span>Tuesday</span><span>8:30am - 4:00pm</span></li>
            <li class="d-flex justify-content-between"><span>Wednesday</span><span>8:30am - 4:00pm</span></li>
            <li class="d-flex justify-content-between"><span>Thursday</span><span>8:30am - 4:00pm</span></li>
            <li class="d-flex justify-content-between"><span>Friday</span><span>8:30am - 3:30pm</span></li>
            <li class="d-flex justify-content-between"><span>Saturday</span><span>9:00am - 11:00am</span></li>
            <li class="d-flex justify-content-between"><span>Sunday</span><span>Closed</span></li>
          </ul>
        </div>
      </div>

      <hr class="my-4">
      <div class="row align-items-center">
        <div class="col-md-6">
          <p class="mb-0 text-muted">© 2023-2025 Lion Tech Zimbabwe. All rights reserved.</p>
        </div>
        <div class="col-md-6 text-md-end">
          <a href="/terms/" class="text-muted me-3 text-decoration-none">Terms & Conditions</a>
          <a href="/privacy/" class="text-muted text-decoration-none">Privacy Policy</a>
        </div>
      </div>
    </div>
  </footer>

  <!-- Image Popup Modal -->
  <div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content  border-0" style="margin: 20px;">
        <div class="modal-body p-0 text-center">
          <img id="modalImage" src="" class="img-fluid rounded shadow" style="max-height: 70vh; max-width: 100%;" alt="Zoomed Image">
          <div class="mt-3">
            <a id="downloadBtn" href="#" download class="btn btn-primary">
              <i class="bi bi-download"></i> Download Image
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Success toast (hidden) -->
  <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1080;">
    <div id="cartSuccessToast" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="polite" aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body text-white">
          Added to cart
        </div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
    </div>
  </div>
  
  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
  <script src="{% static 'website/js/your_order.js' %}"></script>
  <script src="{% static 'website/js/live_search.js' %}"></script>
  <script src="{% static 'website/js/more_details.js' %}"></script>
  <script src="{% static 'website/js/distance_time_calculation.js' %}"></script>
  <script src="{% static 'website/js/product_image_clickable.js' %}"></script>
  <script src="{% static 'website/js/cart_customer_details.js' %}"></script>
  <script src="{% static 'website/js/addCartDataToDBNoRefresh.js' %}"></script>
  <script src="{% static 'website/js/aboutUs.js' %}"></script>

  <style>
      /* Modern CSS Enhancements */
      .bg-gradient-light {
          background: linear-gradient(to bottom, #ffffff 0%, #f8f9fa 100%);
      }
      
      .bg-gradient-primary {
          background: linear-gradient(135deg, #0d6efd 0%, #0b5ed7 100%);
      }
      
      .text-gradient-primary {
          background: -webkit-linear-gradient(45deg, #0d6efd, #0dcaf0);
          -webkit-text-fill-color: transparent;
      }
      
      .modern-card {
          transition: all 0.3s ease;
          border: none;
      }
      
      .modern-card:hover {
          transform: translateY(-5px);
          box-shadow: 0 10px 20px rgba(0,0,0,0.1) !important;
      }
      
      .bundle-badge {
          position: absolute;
          top: 15px;
          left: 15px;
          padding: 5px 10px;
          border-radius: 4px;
          font-size: 12px;
          font-weight: bold;
          z-index: 2;
      }
      
      .animate-pulse {
          animation: pulse 2s infinite;
      }
      
      @keyframes pulse {
          0% { transform: scale(1); }
          50% { transform: scale(1.05); }
          100% { transform: scale(1); }
      }
      
      .transition-all {
          transition: all 0.3s ease;
      }
      
      .hover-shadow-lg:hover {
          box-shadow: 0 10px 20px rgba(0,0,0,0.1) !important;
      }
      
      .modern-category .category-image {
          overflow: hidden;
      }
      
      .modern-category .category-image img {
          transition: transform 0.5s ease;
      }
      
      .modern-category:hover .category-image img {
          transform: scale(1.05);
      }

    /* Tighten spacing / overlap for inline product viewer thumbnails + main image */
    .product-container .row {
      /* remove bootstrap horizontal gutter inside the product container row */
      --bs-gutter-x: 0 !important;
    }

    .product-container .product-thumbs {
      max-width: 200px;
      padding-right: 0;
      /* pull the thumbnails toward the main image so they sit very close / overlap */
      margin-right: -40px;
      z-index: 3; /* sit above main image when overlapping */
    }

    .product-container .product-thumbs img {
      width: 100%;
      height: auto;
      object-fit: contain;
      display: block;
      border-radius: 6px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.06);
    }

    .product-container .product-image-main {
      padding-left: 8px; /* tiny inset so image doesn't stick to thumbs on very tight screens */
      z-index: 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .product-container .product-image-main img {
      position: relative;
      z-index: 1;
    }

    /* Desktop tuning: make overlap slightly larger on large screens */
    @media (min-width: 992px) {
      .product-container .product-thumbs { margin-right: -82px; }
      .product-container .product-image-main { padding-left: 16px; }
    }
  </style>
  
  <script>
    // Make Buy Now predictable: prevent default href navigation (which jumps to top/home)
    // and instead show the product detail container if available. Keep the button visible.
    (function() {
      const setupClick = (el) => {
        if (!el) return;
        // ensure the element won't navigate when clicked
        try { el.setAttribute('href', 'javascript:void(0);'); } catch (e) {}
        el.addEventListener('click', function(evt) {
          evt.preventDefault();
          // If product viewer exists, show it and scroll into view
          const productContainer = document.querySelector('.product-container');
          if (productContainer) {
            productContainer.style.display = 'block';
            productContainer.classList.add('mt-3');
            try {
              const header = document.querySelector('.header-wrapper');
              const headerHeight = header ? header.offsetHeight : 0;
              const top = productContainer.getBoundingClientRect().top + window.pageYOffset - headerHeight - 8;
              window.scrollTo({ top, behavior: 'smooth' });
            } catch (e) { /* ignore scroll errors */ }
            return;
          }

          // Fallback: open product list section if available
          if (window.openSection) window.openSection('promotion_page');
        });
      };

      const btn = document.getElementById('buyNowBtnInlineBtn');
      if (!btn) return;
      try {
        // replace with clone to remove any stale listeners, then attach our controlled handler
        const clone = btn.cloneNode(true);
        btn.parentNode.replaceChild(clone, btn);
        setupClick(clone);
      } catch (e) {
        // if cloning fails, attach directly
        setupClick(btn);
      }
    })();
  </script>

  <script>
      if ('scrollRestoration' in history) {
          history.scrollRestoration = 'manual';
      }
  </script>
  <script>
    (function(){
      // Open product detail inline into #product_details_page when clicking product thumbnails
      function fetchAndShowProduct(id){
        if(!id) return;
        const container = document.getElementById('product_details_page');
        const header = document.querySelector('.header-wrapper');
        const url = window.location.pathname + '?product_view=' + encodeURIComponent(id);

        if (!container) {
          // If we don't have a client-side container, just navigate
          window.location.href = '/product/' + id + '/';
          return;
        }

        // show a minimal loading state so user doesn't see an empty box
        const previous = container.innerHTML;
        container.innerHTML = '<div class="p-4 text-center">Loading product details&hellip;</div>';
        container.style.display = 'block';
        container.classList.add('mt-3');

        fetch(url, { headers: { 'X-Requested-With': 'XMLHttpRequest' } })
          .then(res => res.text())
          .then(html => {
            const doc = new DOMParser().parseFromString(html, 'text/html');
            // Prefer server-side fragment for product details, fallback to product container
            const remote = doc.getElementById('product_details_page') || doc.querySelector('#product_details_page') || doc.querySelector('.product-container') || doc.getElementById('productContainer');

            // Only insert content if the fragment contains meaningful HTML
            const hasRemoteContent = remote && remote.innerHTML && remote.innerHTML.trim().length > 30;
            if (hasRemoteContent) {
              container.innerHTML = remote.innerHTML;

              // Move container right after header so it appears above footer and at top
              if (header && container) header.parentNode.insertBefore(container, header.nextSibling);

              // Ensure mobile view mirrors desktop content (if fragment returned only desktop markup)
              try {
                const mobileWrap = container.querySelector('.MobileViewPg');
                if (mobileWrap) {
                  // copy main image
                  const desktopMain = container.querySelector('#mainProductImage');
                  const mobileMain = mobileWrap.querySelector('#mainProductImageMobile');
                  if (desktopMain && mobileMain) mobileMain.src = desktopMain.src;

                  // copy thumbnails HTML (simple innerHTML copy is fine for a quick sync)
                  const desktopThumbs = container.querySelector('.product-thumbs');
                  const mobileThumbs = mobileWrap.querySelector('.product-thumbs-mobile');
                  if (desktopThumbs && mobileThumbs) mobileThumbs.innerHTML = desktopThumbs.innerHTML;

                  // copy title and price
                  const desktopTitle = container.querySelector('.product-title');
                  const mobileTitle = mobileWrap.querySelector('h4.fw-semibold');
                  if (desktopTitle && mobileTitle) mobileTitle.textContent = desktopTitle.textContent;
                  const desktopPrice = container.querySelector('.product-price');
                  const mobilePrice = mobileWrap.querySelector('.product-price');
                  if (desktopPrice && mobilePrice) mobilePrice.textContent = desktopPrice.textContent;
                }
              } catch (e) { console.warn('mobile fragment sync failed', e); }

              // ensure we have a close button
              if (!container.querySelector('.product-close-btn')) {
                const close = document.createElement('button');
                close.type = 'button';
                close.className = 'product-close-btn btn btn-sm btn-outline-secondary';
                close.style.position = 'absolute';
                close.style.top = '8px';
                close.style.right = '8px';
                close.textContent = 'Close';
                close.addEventListener('click', function(){
                  container.style.display = 'none';
                });
                container.style.position = container.style.position || 'relative';
                container.appendChild(close);
              }

              // Scroll into view below header
              try{
                const headerHeight = header ? header.offsetHeight : 0;
                const top = container.getBoundingClientRect().top + window.pageYOffset - headerHeight - 8;
                window.scrollTo({ top, behavior: 'smooth' });
              }catch(e){}

              // Re-run client-side initializers if available
              if (window.initializeProductCarousels) window.initializeProductCarousels();
              if (window.bindOrderRemoveButtons) window.bindOrderRemoveButtons();
            } else {
              // nothing useful returned — restore previous content and navigate as fallback
              container.innerHTML = previous;
              container.style.display = 'none';
              window.location.href = '/product/' + id + '/';
            }
          })
          .catch(err => {
            console.error('Failed to load product inline, falling back to product page', err);
            container.innerHTML = previous;
            container.style.display = 'none';
            window.location.href = '/product/' + id + '/';
          });
      }

      // Global click handler: look for clicks on product images/anchors
      document.addEventListener('click', function(e){
        if (e.defaultPrevented) return; // another handler already took this click
        const el = e.target.closest && e.target.closest('.clickable-image, a.clickable-image, img.clickable-image');
        if (!el) return;
        // image may be inside an <a>; look for data-product-id attribute on target or ancestor
        let pid = el.getAttribute('data-product-id') || el.dataset.productId;
        if (!pid) {
          const parent = el.closest('[data-product-id]');
          if (parent) pid = parent.getAttribute('data-product-id');
        }
        // try to extract id from href as a fallback (/product/123/)
        if (!pid) {
          const href = el.getAttribute('href') || el.src || '';
          const m = href.match(/product\/(\d+)\/?/);
          if (m) pid = m[1];
        }

        if (pid) {
          e.preventDefault();
          fetchAndShowProduct(pid);
        }
      });
    })();
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const promotionPage = document.getElementById('promotion_page');
      if (window.location.pathname.includes('/product/')) {
        if (promotionPage) {
          promotionPage.style.display = 'block';
        }
      }
    });
  </script>
  <script>
    // Section controller: show/hide main containers, reset product filters when leaving
    (function () {
      const containers = ['homeContent','promotion_page','products_addto_cart','cartContents','HistoryContents','accounts_page','testimonial_page'];

      function hideAll() {
        containers.forEach(id => { const el = document.getElementById(id); if (el) el.style.display = 'none'; });
      }

      // Clear search and any product-list specific state so reopening is unfiltered
      function resetProductFilters() {
        // Clear query input used for live-search
        const liveInput = document.getElementById('liveSearchInput');
        if (liveInput) liveInput.value = '';

        // Remove any active filter marker on the promotion container
        const promo = document.getElementById('promotion_page');
        if (promo && promo.dataset) delete promo.dataset.activeFilter;

        // If the page URL contains filter/search query params, navigate to the base path
        // to get a clean server-rendered product list.
        if (location.search) {
          const base = location.pathname;
          // Use replaceState to avoid creating history if we want a silent reset
          try { history.replaceState(null, '', base); } catch (e) { location.href = base; }
        }
      }

      // Open a named section; when leaving promotion_page we reset its filters
      window.openSection = function (sectionId) {
        const prevPromo = document.getElementById('promotion_page');
        // If we are leaving the promotion page, reset filters
        try {
          const visiblePromo = prevPromo && prevPromo.style.display !== 'none';
          if (visiblePromo && sectionId !== 'promotion_page') {
            resetProductFilters();
          }
        } catch (e) {}

        hideAll();
        const target = document.getElementById(sectionId);
        if (target) {
          target.style.display = 'block';
          try { target.scrollIntoView({ behavior: 'smooth', block: 'start' }); } catch (e) {}
        }

        // update hash for back/forward support
        try { history.replaceState(null, '', '#' + sectionId); } catch (e) {}
      };

      // Bind header nav buttons
      const btnMap = {
        load_home_contents: 'homeContent',
        load_product_list: 'promotion_page',
        load_my_cart: 'products_addto_cart',
        load_accounts: 'accounts_page',
        load_testimony: 'testimonial_page',
        load_history: 'HistoryContents',
        load_about_us: 'about_us_page'
      };

      Object.keys(btnMap).forEach(id => {
        const el = document.getElementById(id);
        if (!el) return;
        el.addEventListener('click', function (e) {
          e.preventDefault();
          const section = btnMap[id];
          // If opening products via header button, make sure it's unfiltered
          if (section === 'promotion_page') resetProductFilters();
          window.openSection(section);
        });
      });

      // Category links: use AJAX to refresh the products fragment so the page
      // does not fully reload or 'shake'. If server returns full HTML, we parse
      // and extract `#productList` and `#productPagination` and replace them.
      document.querySelectorAll('.ajax-category, .category-link').forEach(link => {
        link.addEventListener('click', function (e) {
          e.preventDefault();
          const href = this.getAttribute('href');
          const filter = this.getAttribute('data-filter') || '';

          // open the promotion section (keeps existing UI behavior)
          window.openSection('promotion_page');

          // If there is no href or href doesn't include query params, just set marker and return
          if (!href || !href.includes('?')) {
            const promo = document.getElementById('promotion_page');
            if (promo) promo.dataset.activeFilter = filter;
            return;
          }

          // Perform AJAX fetch to load filtered content and replace product list fragment
          const targetList = document.getElementById('productList');
          const targetPagination = document.getElementById('productPagination');
          if (!targetList) { location.href = href; return; }

          // show loading state
          targetList.style.opacity = '0.6';

          fetch(href, { headers: { 'X-Requested-With': 'XMLHttpRequest' } })
            .then(res => {
              if (!res.ok) throw new Error('Network response was not ok');
              return res.text();
            })
            .then(html => {
              const parser = new DOMParser();
              const doc = parser.parseFromString(html, 'text/html');
              const newList = doc.getElementById('productList');
              const newPagination = doc.getElementById('productPagination');

              if (newList) {
                targetList.innerHTML = newList.innerHTML;
              } else {
                // fallback: if server returned only JSON or a different layout, navigate instead
                location.href = href;
                return;
              }

              // Replace pagination if present
              if (targetPagination && newPagination) {
                targetPagination.innerHTML = newPagination.innerHTML;
              } else if (targetPagination && !newPagination) {
                targetPagination.innerHTML = '';
              }

              // Re-bind any client-side handlers if needed (e.g., product carousels)
              if (window.initializeProductCarousels) window.initializeProductCarousels();

              // restore appearance
              targetList.style.opacity = '';
            })
            .catch(err => {
              console.error('Failed to load filtered products:', err);
              // final fallback to full navigation
              location.href = href;
            });
        });
      });

      // Pagination links within the product area should also use AJAX to avoid full reloads
      document.addEventListener('click', function (e) {
        const a = e.target.closest && e.target.closest('#productPagination a');
        if (!a) return;
        e.preventDefault();
        const href = a.getAttribute('href');
        if (!href) return;

        const targetList = document.getElementById('productList');
        const targetPagination = document.getElementById('productPagination');
        if (!targetList) { location.href = href; return; }

        targetList.style.opacity = '0.6';
        fetch(href, { headers: { 'X-Requested-With': 'XMLHttpRequest' } })
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const newList = doc.getElementById('productList');
            const newPagination = doc.getElementById('productPagination');
            if (newList) targetList.innerHTML = newList.innerHTML;
            if (targetPagination && newPagination) targetPagination.innerHTML = newPagination.innerHTML;
            if (window.initializeProductCarousels) window.initializeProductCarousels();
            targetList.style.opacity = '';
          })
          .catch(() => { location.href = href; });
      });

      // On initial load, if server requested a filter/search make sure products are visible
      document.addEventListener('DOMContentLoaded', function () {
        try {
          if (window.serverFilterInit) {
            const s = window.serverFilterInit;
            if ((s.currentSearch && s.currentSearch.length) || (s.currentFilter && s.currentFilter.length)) {
              // do not reset filters in this case — server intentionally rendered results
              window.openSection('promotion_page');
            }
          }
        } catch (e) {}
      });
    })();
  </script>
  <script>
    (function () {
      // CSRF helper (matches other helpers in this file)
      function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
          const cookies = document.cookie.split(';');
          for (let cookie of cookies) {
            cookie = cookie.trim();
            if (cookie.startsWith(name + '=')) {
              cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
              break;
            }
          }
        }
        return cookieValue;
      }

      // Send remove request and remove the order card from DOM on success
      function removeOrderById(orderId, buttonEl) {
        if (!orderId) return Promise.reject(new Error('missing id'));
        return fetch('/orders/remove/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
          },
          body: JSON.stringify({ id: orderId })
        })
        .then(res => res.json())
        .then(data => {
          if (data && data.success) {
            // remove nearest .order-card container
            const card = buttonEl.closest('.order-card');
            if (card) card.remove();
            return data;
          }
          throw new Error(data && data.message ? data.message : 'remove failed');
        });
      }

      // Bind buttons on DOMContentLoaded and expose a rebind function
      function bindRemoveButtons() {
        document.querySelectorAll('.remove-item-btn').forEach(btn => {
          // Avoid double-binding
          if (btn.__removeBound) return;
          btn.__removeBound = true;
          btn.addEventListener('click', function (e) {
            e.preventDefault();
            const orderId = this.getAttribute('data-order-id');
            if (!orderId) return alert('Order id missing');
            // optimistic UI: disable button while request in flight
            this.disabled = true;
            removeOrderById(orderId, this)
              .catch(err => {
                console.error('Failed to remove order', err);
                alert('Failed to remove order: ' + (err.message || 'unknown'));
                this.disabled = false;
              });
          });
        });
      }

      document.addEventListener('DOMContentLoaded', bindRemoveButtons);

      // expose for dynamic fragments
      window.bindOrderRemoveButtons = bindRemoveButtons;
    })();
  </script>

  <!-- // buttons that triggers another buttons -->
  <script>
    document.getElementById("Buy_Again").addEventListener("click", function () {
      document.getElementById("load_product_list").click();
    });
  </script>

</body>
</html>
